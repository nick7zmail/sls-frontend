{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/map/map.css?b431","webpack:///external \"window.d3\"","webpack:///./src/components/map/links.tsx","webpack:///./src/utils.ts","webpack:///./src/types.ts","webpack:///./src/components/map/nodes.tsx","webpack:///./src/components/map/consts.ts","webpack:///./src/components/map/tooltip.tsx","webpack:///./src/websocket.ts","webpack:///./src/actions.ts","webpack:///./src/legacy-actions.ts","webpack:///./src/components/map/index.tsx","webpack:///./src/components/map/convert.ts","webpack:///./src/components/button/index.tsx","webpack:///./src/components/device-control/index.tsx","webpack:///./src/components/device-page/clusters.ts","webpack:///./src/components/safe-image/index.tsx","webpack:///./src/components/power-source/index.tsx","webpack:///./src/components/zigbee/ActionTH.tsx","webpack:///./src/components/zigbee/index.tsx","webpack:///./src/binaryUtils.ts","webpack:///./src/components/discovery/device-card.tsx","webpack:///./src/components/device-page/bind.tsx","webpack:///./src/components/device-page/bind-row.tsx","webpack:///./src/components/discovery/index.tsx","webpack:///./src/components/log-viewer/index.tsx","webpack:///./src/components/tree-view/index.tsx","webpack:///./src/components/code-editor/codemirror.tsx","webpack:///./src/components/code-editor/index.tsx","webpack:///./src/components/universal-editor/index.tsx","webpack:///./src/components/device-page/simple-bind.tsx","webpack:///./src/components/device-page/info.tsx","webpack:///./src/components/tab-panel/index.tsx","webpack:///./src/components/device-page/index.tsx","webpack:///./src/store.ts","webpack:///./src/index.tsx","webpack:///./src/components/map/tooltip.css?6018","webpack:///./src/components/power-source/style.css?c52c","webpack:///./src/components/device-page/style.css?20cc","webpack:///./src/components/zigbee/style.css","webpack:///./src/components/discovery/style.css?5e9d","webpack:///external \"window.luaparse\"","webpack:///./src/components/code-editor/style.css?9305","webpack:///external \"window.CodeMirror\"","webpack:///./src/components/tree-view/style.css?8a62","webpack:///./src/components/log-viewer/style.css?542d"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","d3","ref","componentDidMount","current","link","render","id","linkType","type","rest","className","this","strokeWidth","xlinkHref","textPath","startOffset","linkQuality","filter","dy","props","links","x","y","width","height","in","map","index","genDeviceDetailsLink","deviceIdentifier","encodeURIComponent","toHex","input","padding","repeat","toString","substr","toUpperCase","genDeviceImageUrl","device","modelName","ModelId","replace","last","collection","bitOps","bitIndex","callApi","url","method","params","payload","callback","contentType","Promise","resolve","reject","fetch","keys","join","body","then","res","status","Error","statusText","catch","e","error","undefined","InterviewState","DeviceSupportStatus","PowerSource","lastSeen","timeInfo","last_seen","ts","secs","Math","floor","v","getStarShape","innerCircleArms","styleStarWidth","innerOuterRadiusRatio","centerX","centerY","innerRadius","outerRadius","angle","PI","totalArms","points","cos","sin","calcStarPoints","isOnline","state","imgUrl","onMouseOut","node","onMouseOver","onDblClick","onImageError","setState","time","deviceType","cn","class","onError","href","updateDrag","simulation","dragForce","on","active","alphaTarget","restart","fx","fy","componentDidUpdate","nodes","GATEWAY","nwkAddr","friendly_name","ManufName","info","tooltip","strings","ieeeAddr","st","linkquality","getTooltip","events","event","listener","removeListener","idx","indexOf","emit","forEach","args","once","remove","remoteSubscribe","category","categories","includes","ws","send","JSON","stringify","action","onMessageReceive","wsEvent","parse","em","console","log","EventEmitter","connect","hostname","wsUrl","document","location","search","addEventListener","subscribe","eventCategory","consumer","store","setLoading","isLoading","getDeviceInfo","dev","err","isError","setBindRules","bindRules","getDeviceBinds","response","rule","loadBindsList","getZigbeeDevicesList","showLoading","devices","removeBind","bindRule","createBind","setStateValue","setSimpleBindValue","setSimpleBind","startInterview","currentInterviewState","fetchTimeInfo","setJoinDuration","duration","target","enableJoin","fetchLogsBuffer","logs","split","copyLogs","getCurrentLogLevel","logLevel","clearLogs","clearLogsBuffer","setLogLevel","level","setCurrentFileContent","currentFileContent","evalCode","code","executionResults","clearExecutionResults","writeFile","path","content","getFilesList","files","readFile","file","currentFile","deleteFile","renameDevice","old","newName","new","removeDevice","force","getDistance","setTooltip","tooltipNode","removeTooltip","openDetailsWindow","open","graph","updateNodes","updateForces","linkLabel","attr","max","min","source","bbox","getBBox","linkForce","distance","strength","chargeForce","distanceMin","distanceMax","repelForce","collisionForce","iterations","centerForce","initPage","coordinator","getLinkType","dest","deviceData","friendlyName","Array","isArray","Rtg","route","find","convert2graph","getBoundingClientRect","container","viewBox","foreignObject","onClick","item","children","onBindClick","onRenameClick","prompt","onRemoveClick","confirm","validDevice","role","ZigbeeClusters","isOk","description","PowerSourceComp","battery","batteryClass","hasSecondaryPowerSource","Battery","title","EmergencyMains","MainsThreePhase","EmergencyMainsConstantPower","MainsSinglePhase","plug","DC","Unknown","preventDefault","stopPropagation","column","renderArrow","currentDirection","invisible","saveState","storeData","sortDirection","sortColumn","localStorage","setItem","loadData","debouncedLoadData","onInterviewClick","Interview","State","success","onSortChange","sortDir","restoreState","storedState","getItem","restored","initWs","renderDevicesTable","renderInterviewState","interviewTrigger","getSupportTitle","supported","Supported","UnSupported","sortedDevices","adaptive","zigbee","titile","flags","src","EventLabels","Map","RowCol","EventRow","eventName","ParentnwkAddr","ep","ProfileId","DeviceId","evt","manualInterviewStarted","updateTimerId","setInterval","currentTimestamp","Date","now","isDone","getLastEvent","getLastUpdateTime","timestamp","round","messageTimestamp","getLastUpdateTimeMessage","getInterviewText","lastEvent","renderManualInterviewHelper","lastUpdateTime","blink","componentWillReceiveProps","nextProps","nextContext","clearInterval","groupedEvents","eventsCount","progressValue","style","entries","getClusterName","addBraces","cleanName","onRuleChange","copyRules","onUnBindClick","renderBindsTable","scope","onChange","fields","isValidBindRule","some","getDeviceDisplayName","onDstChange","DstNwkAddr","DstEp","onClusterChange","SrcEp","ClusterId","onDstEpChange","parseInt","isExistingBinding","renderDstSelect","options","values","In","selected","unshift","hidden","disabled","renderClusterId","optionGroups","epNumber","clusters","Out","label","renderDstEp","dstDevice","dstEndpoints","concat","epName","renderActionButton","LogLevel","wsEventsData","processZigbeeEvent","message","joinDuration","targetRouter","position","disableJoin","manager","setTimeout","renderDevices","sortedEvents","reverse","renderJoinButton","routers","router","renderEmptyScreen","hasAnyEvents","onFollowLogChange","followLog","onClearScreenClick","onClearCacheClick","onLogLevelChange","scrollToBottom","scrollTop","scrollHeight","LOG_OFF","LOG_NORMAL","LOG_VERBOSE","LOG_DEBUG","checked","for","line","lineNum","items","onDeleteClick","onItemClick","registerHelper","text","found","parseResult","from","Pos","to","codemirrorValueChanged","doc","change","origin","getValue","config","codeMirror","fromTextArea","setValue","setSize","setOption","currentCode","prevScrollPosition","getScrollInfo","prevCursor","getCursor","scrollTo","left","top","setCursor","onCodeChange","onExecuteCode","onSaveCode","onCreateFile","fileName","startsWith","loadFiles","loadFile","toggleSideBar","sideBarIsVisible","onFormatClick","getFileType","renderCodeExecutionResults","fileExtPattern","test","getMode","json","theme","styleActiveLine","lineNumbers","lint","gutters","extraKeys","hasExecutionResults","hasCode","wrapper","toggled","placeholder","readOnly","changeHandler","valueAsNumber","step","onBlur","renderSimpleBinds","simpleBindRules","SB","kv","param","renderDeviceInfo","endpoints","inClusters","clusterId","cluster","outClusters","profId","devId","isActive","onTabLinkClick","activeTab","initializeDefaultTab","defaultTab","tabs","TabComponent","searchParams","paramActiveTab","deviceId","loader","initialState","DevicePageApp","ZigbeeTableApp","MapApp","DiscoveryApp","LogViewerApp","CodeEditorApp","selector","clean","luaparse","CodeMirror"],"mappings":"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","file":"scripts/main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"2YZa\",1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"_3UsUxhqLZHNtuszm8EI_1s\",\"img\":\"fuuZbvihQGWIy3CO8t5fw\",\"node\":\"I_ddn1k4fvLAQLh2qam_d\",\"link\":\"oJeonYZxCbLDqS9yrBiG5\",\"linkLabel\":\"ipEfrGz4VI8P2v-Hm0MgN\",\"links\":\"qlfIBJJwZ24x2b-QgFmLW\",\"nodes\":\"_1eZESYvchmyr8mmKIBCmBR\",\"EndDevice\":\"_113dX3BKO5fr4pAzdXC69K\",\"Coordinator\":\"_3-cVoVzbbOOvbMydd2G1J6\",\"Router\":\"_1NuCcdsGVpzqyMOXPkAEco\",\"Router2Coordinator\":\"_16GkebpgcHFnf2uJIgqlWu\",\"Router2Router\":\"_2nbipMaMmif3N4YQw4wgIC\",\"EndDevice2Coordinator\":\"_2kxuG_VR9_Fy7SGa4OSXVQ\",\"EndDevice2Router\":\"_3fc-4gZS_GCPbobf1dvlBo\",\"foreignObject\":\"nnn_JJwC5kC3gKbpcaXVA\",\"offline\":\"_2eFLqqfzaRUzHTEot23elk\"};","module.exports = window.d3;","import { LinkI } from \"./types\";\nimport { Component, ComponentChild, createRef, FunctionalComponent, h, RefObject } from \"preact\";\nimport * as style from \"./map.css\";\nimport cx from \"classnames\";\nimport * as d3 from \"d3\";\n\ninterface LinkProps {\n    link: LinkI;\n    id?: string;\n}\n\nclass Link extends Component<LinkProps, {}> {\n    ref = createRef<SVGPathElement>();\n\n    componentDidMount(): void {\n        const { current } = this.ref;\n        const { link } = this.props;\n        d3.select(current as SVGPathElement).data([link]);\n    }\n\n    render(): ComponentChild {\n        const { link, id, ...rest } = this.props;\n        const linkType = link.type as string;\n        return (\n            <path\n                id={id}\n                {...rest}\n                className={cx(style.link, style[linkType])}\n                ref={this.ref as RefObject<SVGPathElement>}\n                strokeWidth={1}\n            />\n        );\n    }\n}\n\ninterface LinkLabelProps extends LinkProps {\n    xlinkHref: string;\n}\n\nclass LinkLabel extends Component<LinkLabelProps, {}> {\n    ref = createRef<SVGTextElement>();\n\n    componentDidMount(): void {\n        const { current } = this.ref;\n        const { link } = this.props;\n        d3.select(current as SVGTextElement).data([link]);\n    }\n\n    render(): ComponentChild {\n        const { link, xlinkHref } = this.props;\n        /* eslint-disable @typescript-eslint/ban-ts-ignore */\n        //@ts-ignore\n        const textPath = <textPath startOffset=\"50%\" xlinkHref={xlinkHref}>{link.linkQuality}</textPath>;\n        return (\n            <text\n                filter={\"url(#solid)\"}\n                className={style.linkLabel}\n                ref={this.ref}\n                dy={4}\n            >{textPath}\n            </text>\n        );\n    }\n}\n\ninterface LinksPros {\n    links: LinkI[];\n}\n\nconst Links: FunctionalComponent<LinksPros> = props => {\n    const { links } = props;\n    return (\n        <g className={style.links}>\n            <defs>\n                <filter x=\"-0.1\" y=\"0\" width=\"1.2\" height=\"1\" id=\"solid\">\n                    <feFlood flood-color=\"#eef5f9\" />\n                    <feComposite in=\"SourceGraphic\" />\n                </filter>\n            </defs>\n            {links.map((link: LinkI, index: number) => (\n                <Link\n                    id={`edgepath${index}`}\n                    key={`link${index}`}\n                    link={link}\n                />\n            ))}\n            {links.map((link: LinkI, index: number) => (\n                <LinkLabel\n                    xlinkHref={`#edgepath${index}`}\n                    key={`label${index}`}\n                    link={link}\n                />\n            ))}\n        </g>\n    );\n};\nexport default Links;\n","import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport { Device, Dictionary } from \"./types\";\nimport { TimeInfo } from \"./components/discovery/types\";\nimport { Notyf } from \"notyf\";\n\nexport const genDeviceDetailsLink = (deviceIdentifier: string | number): string => (`/zigbee/device?dev=${encodeURIComponent(deviceIdentifier)}&activeTab=Info`);\n\nexport const toHex = (input: number, padding = 4): string => {\n    return `0x${(`${'0'.repeat(padding)}${input.toString(16)}`).substr(-1 * padding).toUpperCase()}`;\n};\n\n/**\n * Returns an array with arrays of the given size.\n *\n * @param inputArr {Array} array to split\n * @param chunkSize {Integer} Size of every group\n */\nexport function chunkArray<T>(inputArr: T[], chunkSize: number): T[][] {\n\n    const results = [];\n    while (inputArr.length) {\n        results.push(inputArr.splice(0, chunkSize));\n    }\n    return results;\n}\n\nexport const encodeGetParams = (data: Dictionary<string | number>): string => Object.keys(data).map((key) => [key, data[key]].map(encodeURIComponent).join(\"=\")).join(\"&\");\n\nexport const WSConnect = (): ReconnectingWebSocket => {\n    const { hostname } = document.location;\n    if (hostname === \"localhost\") {\n        const { search } = document.location;\n        if (search.indexOf(\"gate\") > 0) {\n            return new ReconnectingWebSocket(`ws://192.168.1.209:81/log`);\n        }\n        return new ReconnectingWebSocket(`ws://localhost:8579`);\n    } else return new ReconnectingWebSocket(`ws://${document.location.hostname}:81/log`);\n};\n\nexport const sanitizeModelNameForImageUrl = (modelName: string): string => {\n    return modelName ? modelName.replace(\"/\", \"_\") : null;\n};\n\nexport const genDeviceImageUrl = (device: Device): string => (`https://raw.githubusercontent.com/slsys/Gateway/master/devices/png/${sanitizeModelNameForImageUrl(device.ModelId)}.png`);\n\nexport type LoadableFileTypes = \"js\" | \"css\";\n\nexport const fetchJs = (url) => {\n    return new Promise((resolve, reject) => {\n        const scriptElement = document.createElement(\"script\");\n        scriptElement.addEventListener(\"load\", resolve);\n        scriptElement.addEventListener(\"error\", reject);\n        scriptElement.setAttribute(\"type\", \"text/javascript\");\n        scriptElement.setAttribute(\"src\", url);\n        document.getElementsByTagName(\"head\")[0].appendChild(scriptElement);\n    });\n};\n\nexport const fetchStyle = (url) => {\n    return new Promise((resolve, reject) => {\n        const link = document.createElement(\"link\");\n        link.addEventListener(\"load\", resolve);\n        link.addEventListener(\"error\", reject);\n        link.setAttribute(\"type\", \"text/css\");\n        link.setAttribute(\"rel\", \"stylesheet\");\n        link.setAttribute(\"href\", url);\n        document.getElementsByTagName(\"head\")[0].appendChild(link)\n    });\n};\n\nexport function last<T>(collection: T[]) {\n    return collection[collection.length - 1];\n}\nexport function arrayUnique<T>(input: T[]) {\n    return input.filter((v, i, a) => a.indexOf(v) === i);\n}\n\n\n\nexport const bitOps = {\n    getBit: (n: number, bitIndex: number): number => {\n        const bitMask = 1 << bitIndex;\n        const result = n & bitMask;\n        return result >>> bitIndex;\n    },\n    setBit: (n: number, bitIndex: number): number => {\n        const bitMask = 1 << bitIndex;\n        return n | bitMask;\n    },\n    clearBit: (n: number, bitIndex: number): number => {\n        const bitMask = ~(1 << bitIndex);\n        return n & bitMask;\n    }\n};\n\n\nexport const toHHMMSS = (secs: number): string => {\n    const hours = Math.floor(secs / 3600);\n    const minutes = Math.floor(secs / 60) % 60;\n    const seconds = secs % 60;\n\n    return [hours, minutes, seconds]\n        .map(v => v < 10 ? `0${v}` : v)\n        .filter((v, i) => v !== \"00\" || i > 0)\n        .join(\":\");\n};\ntype HttMethod = \"GET\" | \"POST\" | \"DELETE\";\ntype ContentType = \"text\" | \"json\" | \"blob\";\nexport type CallbackHandler<T> = (err: boolean, res: T) => void;\nexport interface ApiResponse<T> {\n    success: boolean;\n    result: T;\n}\nexport function callApi<T>(url: string, method: HttMethod, params: Dictionary<any>, payload: any, callback: CallbackHandler<T>, contentType: ContentType = \"json\"): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n        fetch(`${url}?${encodeGetParams(params)}`, { method, body: payload })\n            .then((res) => {\n                if (res.status === 200) {\n                    return res[contentType]();\n                }\n                throw new Error(res.statusText);\n\n            })\n            .then(data => {\n                callback(false, data);\n                resolve();\n            })\n            .catch(e => {\n                new Notyf().error(e.toString());\n                callback(e.toString(), undefined);\n                reject();\n            });\n    })\n}\n\nexport const lastSeen = (device: Device, timeInfo: TimeInfo): string => {\n    if (device.last_seen && timeInfo) {\n        const lastSeen = timeInfo.ts - device.last_seen;\n        if (lastSeen < 0) {\n            return \"Now\";\n        }\n        return toHHMMSS(lastSeen);\n    }\n};","import { Named } from \"./components/tree-view\";\n\nexport type DeviceType = \"EndDevice\" | \"Router\" | \"Coordinator\";\n\nexport type Dictionary<V> = { [index: string]: V }\n\nexport interface DeviceStats {\n    linkquality?: number;\n    battery?: number;\n    [k: string]: string | number;\n}\n\nexport const inteviewsCount = 4;\n\nexport enum InterviewState {\n    StateUnknown = -1,\n    AnnouncementReceived = 0,\n    DescriptionRecieved = 1,\n    EndpointsRecieved = 2,\n    ClustersRecieved = 3,\n    ModelRecieved = 4\n}\n\n\ninterface Interview {\n    /** Last intreview timestamp */\n    TS?: number;\n    /**\n     * 0 - получен анонс, запускает интервью\n     * 1 - получено описание устройства\n     * 2 - получено количествы активные эндпоинты\n     * 3 - получены кластеры\n     * 4- получена модель\n     */\n    State?: InterviewState;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Cluster {\n\n}\n\nexport interface Endpoint {\n    \"profId\": string;\n    \"In\": Dictionary<true>;\n    \"Out\": Dictionary<true>;\n    \"devId\": string;\n}\n\nexport enum DeviceSupportStatus {\n    Unknown = 0,\n    Supported = 1,\n    UnSupported = 2\n}\n\n\nexport enum PowerSource {\n    Unknown = 0,\n    MainsSinglePhase = 1,\n    MainsThreePhase = 2,\n    Battery = 3,\n    DC = 4,\n    EmergencyMainsConstantPower = 5,\n    EmergencyMains = 6\n}\n\nexport interface Device {\n    /** A 64-bit IEEE address (also called MAC address or Extended address) */\n    ieeeAddr?: string | undefined;\n    /** A 16-bi network address */\n    nwkAddr: string;\n    /** Node last message timestamp */\n    last_seen?: number | undefined;\n    type?: DeviceType | undefined;\n\n    ManufName?: string | undefined;\n    ModelId?: string | undefined;\n    /** Device status */\n    st?: DeviceStats | undefined;\n    friendly_name?: string | undefined;\n    /** Routes list, each item is an 16-bit network address (also called logical address or short address). */\n    Rtg?: string[] | undefined;\n    /** Features discovery status, aka interview */\n    Interview?: Interview | undefined;\n    PowerSource?: PowerSource | undefined;\n    ep?: Dictionary<Endpoint> | undefined;\n    supported?: DeviceSupportStatus | undefined;\n    SB?: Dictionary<string> | undefined;\n\n\n    flags?: number | undefined;\n    Rcf?: unknown;\n}\n\n\nexport interface FileDescriptor extends Named {\n    name: string;\n    size: number;\n    is_dir: boolean;\n}\n\n\nexport interface BindRule extends Dictionary<string|number> {\n    id?: number;\n    DstNwkAddr: string;\n    ClusterId: number;\n    SrcEp: number;\n    DstEp: number;\n}\n\nexport type SortDirection = \"asc\" | \"desc\";","import { Component, ComponentChild, createRef, h, RefObject } from \"preact\";\n\n\nimport * as d3 from \"d3\";\nimport { LinkI, NodeI } from \"./types\";\nimport cx from \"classnames\";\n\nimport * as style from \"./map.css\";\nimport { MouseEventsResponderNode } from \".\";\nimport { Device } from \"../../types\";\nimport { genDeviceImageUrl } from \"../../utils\";\nimport { TimeInfo } from \"../discovery/types\";\n\nconst calcStarPoints = (\n    centerX: number,\n    centerY: number,\n    innerCircleArms: number,\n    innerRadius: number,\n    outerRadius: number\n): string => {\n    const angle = Math.PI / innerCircleArms;\n    const angleOffsetToCenterStar = 60;\n    const totalArms = innerCircleArms * 2;\n    let points = \"\";\n    for (let i = 0; i < totalArms; i++) {\n        const isEvenIndex = i % 2 == 0;\n        const r = isEvenIndex ? outerRadius : innerRadius;\n        const currX = centerX + Math.cos(i * angle + angleOffsetToCenterStar) * r;\n        const currY = centerY + Math.sin(i * angle + angleOffsetToCenterStar) * r;\n        points += `${currX}, ${currY} `;\n    }\n    return points;\n};\n\n\nconst getStarShape = (innerCircleArms: number, styleStarWidth: number, innerOuterRadiusRatio: number): string => {\n    return calcStarPoints(\n        15,\n        15,\n        innerCircleArms,\n        styleStarWidth,\n        innerOuterRadiusRatio\n    );\n};\n\ninterface NodeProps extends MouseEventsResponderNode {\n    time: TimeInfo;\n    node: NodeI;\n}\n\nconst offlineTimeout = 3600 * 2;\n\nexport const isOnline = (device: Device, timeInfo: TimeInfo | undefined): boolean => {\n    if (!timeInfo || !device.last_seen) {\n        return true;\n    }\n    return timeInfo.ts - device.last_seen < offlineTimeout;\n};\n\ninterface NodeState {\n    imgUrl: string;\n}\n\nclass Node extends Component<NodeProps, NodeState> {\n    ref = createRef<SVGPolygonElement | SVGCircleElement | SVGImageElement>();\n    state = {\n        imgUrl: \"\"\n    };\n\n    componentDidMount(): void {\n        const { current } = this.ref;\n        const { node } = this.props;\n\n        d3.select(current as SVGElement).data([node]);\n\n        // eslint-disable-next-line react/no-did-mount-set-state\n        this.setState({\n            imgUrl: genDeviceImageUrl(node.device)\n        });\n    }\n\n\n    onMouseOut = (): void => {\n        const { node, onMouseOut } = this.props;\n        onMouseOut && onMouseOut(node);\n    };\n\n    onMouseOver = (): void => {\n        const { node, onMouseOver } = this.props;\n        onMouseOver && onMouseOver(node);\n    };\n\n    onDblClick = (): void => {\n        const { node, onDblClick } = this.props;\n        onDblClick && onDblClick(node);\n    };\n\n\n    onImageError = (): void => {\n        this.setState({\n            imgUrl: \"https://raw.githubusercontent.com/slsys/Gateway/master/devices/png/generic-zigbee-device.png\"\n        });\n    };\n\n    render(): ComponentChild {\n        const { imgUrl } = this.state;\n        const { node, time } = this.props;\n        const { onMouseOver, onMouseOut, onDblClick, onImageError } = this;\n        const deviceType = (node.device as Device).type as string;\n        const cn = cx(style.node, style[deviceType], { [style.offline]: !isOnline(node.device, time) });\n        return (<g class={cn}\n                   ref={this.ref as RefObject<SVGImageElement>}\n                   onMouseOver={onMouseOver}\n                   onMouseOut={onMouseOut}\n                   onDblClick={onDblClick}>\n            {\n                node.device.type === \"Coordinator\" ? (\n                    <polygon\n                        points={getStarShape(5, 5, 14) as string}\n                    />\n                ) : (\n                    <image\n                        width={32}\n                        height={32}\n                        onError={onImageError}\n\n                        className={`${style.img}`}\n\n                        href={imgUrl}\n                    />\n                )\n            }\n            <text>{node.name}</text>\n\n        </g>);\n\n    }\n}\n\ninterface NodesProps extends MouseEventsResponderNode {\n    time: TimeInfo;\n    nodes: NodeI[];\n    simulation: d3.Simulation<NodeI, LinkI>;\n}\n\ninterface NodesState {\n    tooltipNode: NodeI | undefined;\n}\n\nexport default class Nodes extends Component<NodesProps, NodesState> {\n    updateDrag(): void {\n        const { simulation } = this.props;\n        const dragForce = d3.drag<SVGCircleElement, NodeI>()\n            .on(\"start\", d => {\n                if (!d3.event.active) {\n                    simulation.alphaTarget(0.3).restart();\n                }\n                d.fx = d.x;\n                d.fy = d.y;\n            })\n            .on(\"drag\", d => {\n                d.fx = d3.event.x;\n                d.fy = d3.event.y;\n            })\n            .on(\"end\", d => {\n                if (!d3.event.active) {\n                    simulation.alphaTarget(0);\n                }\n                d.fx = undefined;\n                d.fy = undefined;\n            });\n\n\n        d3.selectAll<SVGCircleElement, NodeI>(`.${style.node}`)\n            .call(dragForce);\n    }\n\n    componentDidMount(): void {\n        this.updateDrag();\n    }\n\n    componentDidUpdate(): void {\n        this.updateDrag();\n    }\n\n    render(): ComponentChild {\n        const { nodes, onMouseOut, onMouseOver, onDblClick, time } = this.props;\n        return (\n            <g className={style.nodes}>\n                {nodes.map((node: NodeI, index: number) => (\n                    <Node\n                        time={time}\n                        onMouseOut={onMouseOut}\n                        onMouseOver={onMouseOver}\n                        onDblClick={onDblClick}\n                        key={index}\n                        node={node}\n                    />\n                ))}\n            </g>\n        );\n    }\n}\n","import { Device } from \"../../types\";\n\n\nexport const GATEWAY: Device = {\n    nwkAddr: \"coordinator\",\n    // eslint-disable-next-line @typescript-eslint/camelcase\n    friendly_name: \"Coordinator node\",\n    // eslint-disable-next-line @typescript-eslint/camelcase\n    type: \"Coordinator\",\n    ManufName: \"SLS gateway\"\n};\n","import { NodeI } from \"./types\";\nimport style from \"./tooltip.css\";\nimport { FunctionalComponent, h } from \"preact\";\nimport { isOnline } from \"./nodes\";\nimport { Device } from \"../../types\";\nimport { lastSeen } from \"../../utils\";\nimport { TimeInfo } from \"../discovery/types\";\n\ninterface TooltipProps {\n    info: NodeI;\n    time: TimeInfo;\n}\n\nconst getTooltip = (device: Device, timeInfo: TimeInfo): string[] => {\n    const strings: string[] = [];\n    if (device.ManufName) {\n        if (device.ModelId) {\n            strings.push(`${device.ManufName} ${device.ModelId}`);\n        } else {\n            strings.push(device.ManufName);\n        }\n    }\n    if (device.ieeeAddr) {\n        strings.push(device.ieeeAddr);\n    }\n    if (device?.st?.linkquality) {\n        strings.push(`LinkQuality: ${device.st.linkquality}`);\n    }\n    if (strings.length == 0) {\n        strings.push(\"A very strange device...\");\n    }\n    if (device.type !== \"Coordinator\") {\n        if (device.last_seen && timeInfo) {\n            strings.push(`Last seen: ${lastSeen(device, timeInfo)}`);\n        }\n        if (!isOnline(device, timeInfo)) {\n            strings.push(\"Offline\");\n        }\n    }\n    return strings;\n};\n\nconst Tooltip: FunctionalComponent<TooltipProps> = (props: TooltipProps) => {\n    const { info, time } = props;\n    const { device } = info;\n    return (\n        <div className={style.tooltip}>\n            {getTooltip(device, time).map((s) => <div>{s}</div>)}\n        </div>\n\n    );\n};\nexport default Tooltip;","import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport { WebsocketMessage } from \"./components/discovery/types\";\nimport { Notyf } from \"notyf\";\nimport {PubSub} from \"pubsub-ts\";\nimport { Dictionary } from \"./types\";\ntype ZigbeeCallback = (payload: WebsocketMessage) => void;\n\nclass EventEmitter {\n    events: Dictionary<Function[]>;\n    constructor() {\n        this.events = {};\n    }\n    on(event: string, listener: Function): Function {\n        if (typeof this.events[event] !== 'object') {\n            this.events[event] = [];\n        }\n        this.events[event].push(listener);\n        return () => this.removeListener(event, listener);\n    }\n    removeListener(event: string, listener: Function): void {\n        if (typeof this.events[event] === 'object') {\n            const idx = this.events[event].indexOf(listener);\n            if (idx > -1) {\n                this.events[event].splice(idx, 1);\n            }\n        }\n    }\n    emit(event: string, ...args) {\n        if (typeof this.events[event] === 'object') {\n            this.events[event].forEach(listener => listener.apply(this, args));\n        }\n    }\n    once(event: string, listener: Function) {\n        const remove = this.on(event, (...args) => {\n            remove();\n            listener.apply(this, args);\n        });\n    }\n}\n\nexport default class WebsocketManager {\n    ws: ReconnectingWebSocket;\n    publisher: PubSub.Publisher;\n    em: EventEmitter;\n    categories: string[];\n\n    remoteSubscribe = (category: string): void => {\n        if (!this.categories.includes(category)) {\n            this.categories.push(category);\n        }\n        this.ws.send(JSON.stringify({ action: \"subscribe\", category }))\n    }\n\n    private connect() {\n        const { hostname } = document.location;\n        let wsUrl = `ws://${document.location.hostname}:81/log`;\n        if (hostname === \"localhost\") {\n            const { search } = document.location;\n            if (hostname === \"localhost\") {\n                if (search.indexOf(\"gate\") > 0) {\n                    wsUrl = `ws://192.168.1.209:81/log`;\n                } else {\n                    wsUrl = `ws://localhost:8579`;\n                }\n            }\n        }\n        this.ws = new ReconnectingWebSocket(wsUrl);\n        this.ws.addEventListener(\"open\", () => {\n            this.categories.forEach(this.remoteSubscribe);\n        })\n        this.ws.addEventListener(\"message\", this.onMessageReceive);\n    }\n\n    constructor() {\n        this.categories = [];\n        this.em = new EventEmitter();\n        // this.publisher = new PubSub.Publisher();\n        this.connect();\n    }\n    onMessageReceive = (wsEvent: MessageEvent): void => {\n        try {\n            const event = JSON.parse(wsEvent.data) as WebsocketMessage;\n            this.em.emit(event.category, event);\n            // this.publisher.notify(event.category, event);\n        } catch (e) {\n            new Notyf().error(`Cant parse json, ${e}`);\n            console.log(`Cant parse json, ${e}`, wsEvent.data);\n        }\n    };\n\n    subscribe(eventCategory: string, consumer: ZigbeeCallback) {\n\n\n\n        this.remoteSubscribe(eventCategory);\n        return this.em.on(eventCategory, consumer)\n    }\n}","/* eslint-disable @typescript-eslint/no-unused-vars */\n\n\nimport { GlobalState } from \"./store\";\nimport { Store } from \"unistore\";\nimport {\n    fetchZigbeeDevicesList,\n    getDeviceInfo,\n    loadBindsList,\n    setState,\n    setSimpleBind,\n    startInterview,\n    fetchTimeInfo,\n    enableJoin,\n    fetchLogsBuffer,\n    getCurrentLogLevel,\n    clearLogsBuffer,\n    setLogLevel,\n    evalCode,\n    writeFile,\n} from \"./legacy-actions\";\nimport { BindRule, FileDescriptor } from \"./types\";\nimport { LogLevel } from \"./components/log-viewer\";\nimport WebsocketManager from \"./websocket\";\nimport orderBy from \"lodash/orderBy\";\nimport { ApiResponse, callApi } from \"./utils\";\n\nexport interface Actions {\n    setLoading(isLoading: boolean): void;\n\n    getDeviceInfo(dev: string): void;\n\n    getDeviceBinds(dev: string): void;\n\n    getZigbeeDevicesList(showLoading: boolean): Promise<void>;\n\n    removeBind(dev: string, bindRule: BindRule): Promise<void>;\n\n    createBind(dev: string, bindRule: BindRule): Promise<void>;\n\n    setBindRules(bindRules: BindRule[]): void;\n\n\n    setStateValue(dev: string, name: string, value: unknown): Promise<void>;\n    setSimpleBindValue(dev: string, name: string, value: unknown): Promise<void>;\n\n    startInterview(dev: string, state: number | \"\"): Promise<void>;\n\n    fetchTimeInfo(): void;\n\n    setJoinDuration(duration: number, target: string): Promise<void>;\n    fetchLogsBuffer(): Promise<void>;\n    getCurrentLogLevel(): Promise<void>;\n    clearLogs(): void;\n    clearLogsBuffer(): Promise<void>;\n    setLogLevel(level: LogLevel): Promise<void>;\n\n    setCurrentFileContent(content: string): void;\n\n    evalCode(code: string): Promise<void>;\n    writeFile(fileName: string, content: string): Promise<void>;\n\n    clearExecutionResults(): void;\n\n    getFilesList(path: string): void;\n\n    readFile(file: FileDescriptor): void;\n    deleteFile(file: FileDescriptor): Promise<void>;\n\n    renameDevice(old: string, newName: string): Promise<void>;\n    removeDevice(dev: string, force: boolean): Promise<void>;\n}\n\nconst actions = (store: Store<GlobalState>): object => ({\n    setLoading(state, isLoading: boolean): void {\n        store.setState({ isLoading });\n    },\n    getDeviceInfo: (state, dev: string): void => {\n        store.setState({ isLoading: true });\n        getDeviceInfo(dev, (err, device) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                device\n            });\n        }).then();\n    },\n\n    setBindRules(state, bindRules: BindRule[]): void {\n        store.setState({ bindRules });\n    },\n    getDeviceBinds: (state, dev: string): void => {\n        store.setState({ isLoading: true });\n        loadBindsList(dev, (err, bindRules: []) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                bindRules: [{} as BindRule, ...bindRules]\n            });\n        }).then();\n    },\n    getZigbeeDevicesList: (state, showLoading = true): Promise<void> => {\n        showLoading && store.setState({ isLoading: true });\n        return fetchZigbeeDevicesList((err, devices) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                devices\n            });\n        });\n    },\n\n    removeBind: (state, dev: string, bindRule: BindRule): Promise<void> => {\n        store.setState({ isLoading: true });\n        return callApi(\"/api/zigbee/bind\", \"POST\", { action: \"unbind\", dev, ...bindRule }, undefined, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        })\n    },\n    createBind: (state, dev: string, bindRule: BindRule): Promise<void> => {\n        store.setState({ isLoading: true });\n        return callApi(\"/api/zigbee/bind\", \"POST\", { action: \"bind\", dev, ...bindRule }, undefined, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        });\n    },\n\n\n    setStateValue(state, dev: string, name: string, value: unknown): Promise<void> {\n        store.setState({ isLoading: true });\n        return setState(dev, name, value, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        });\n    },\n    setSimpleBindValue(state, dev: string, name: string, value: unknown): Promise<void> {\n        store.setState({ isLoading: true });\n        return setSimpleBind(dev, name, value, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        });\n    },\n    startInterview(state, dev: string, currentInterviewState: number | \"\"): Promise<void> {\n        store.setState({ isLoading: true });\n        return startInterview(dev, currentInterviewState, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        });\n    },\n    fetchTimeInfo(state): Promise<void> {\n        return fetchTimeInfo((err, time) => {\n            store.setState({ time });\n        });\n    },\n\n    setJoinDuration(state, duration = 255, target = \"\"): Promise<void> {\n        store.setState({ isLoading: true });\n        return enableJoin(duration, target, (err, time) => {\n            store.setState({ isLoading: false });\n        });\n    },\n    fetchLogsBuffer(state): Promise<void> {\n        return new Promise((resolve, reject) => {\n            store.setState({ isLoading: true });\n            fetchLogsBuffer((err, logs) => {\n                store.setState({\n                    isError: err,\n                    isLoading: false,\n                    logs: logs.split(\"\\n\")\n                });\n                resolve();\n            }).then(() => {\n                const wsManager = new WebsocketManager();\n                wsManager.subscribe(\"log\", (data) => {\n                    const { logs } = store.getState();\n                    const copyLogs = [...logs, data.payload as string];\n                    store.setState({ logs: copyLogs });\n                });\n            })\n        })\n\n    },\n    getCurrentLogLevel(state): Promise<void> {\n        store.setState({ isLoading: true });\n        return getCurrentLogLevel((err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                logLevel: response.result\n            });\n        });\n    },\n    clearLogs(state): void {\n        store.setState({ logs: [] });\n    },\n    clearLogsBuffer(state): Promise<void> {\n        store.setState({ isLoading: true });\n        return clearLogsBuffer((err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    setLogLevel(state, level: LogLevel): Promise<void> {\n        store.setState({ isLoading: true });\n        return setLogLevel(level, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    setCurrentFileContent(state, currentFileContent: string): void {\n        store.setState({ currentFileContent });\n    },\n    evalCode(state, code): Promise<void> {\n        store.setState({ isLoading: true });\n        return evalCode(code, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err,\n                executionResults: res\n            });\n        });\n    },\n    clearExecutionResults(state): void {\n        store.setState({ executionResults: null });\n    },\n    writeFile(state, path, content): Promise<void> {\n        store.setState({ isLoading: true });\n        return writeFile(path, content, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    getFilesList(state, path: string): void {\n        store.setState({ isLoading: true });\n        callApi<ApiResponse<FileDescriptor[]>>(\"/api/files\", \"GET\", { path }, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err,\n                files: orderBy(res.result, [\"name\"])\n            });\n        }).then();\n    },\n\n    readFile(state, file: FileDescriptor): void {\n        store.setState({ isLoading: true });\n        callApi<string>(\"/api/files\", \"GET\", { path: file.name }, undefined, (err, response) => {\n            store.setState({\n                isLoading: false,\n                isError: err,\n                currentFileContent: response,\n                currentFile: file\n            });\n        }, \"text\").then();\n\n    },\n\n    deleteFile(state, file: FileDescriptor): Promise<void> {\n        store.setState({ isLoading: true });\n        return callApi<void>(\"/api/files\", \"DELETE\", { path: file.name }, undefined, (err, response) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    renameDevice: (state, old: string, newName: string): Promise<void> => {\n        store.setState({ isLoading: true });\n        return callApi<ApiResponse<void>>(\"/api/zigbee/rename\", \"GET\", { old, new: newName }, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    removeDevice: (state, dev: string, force: boolean): Promise<void> => {\n        store.setState({ isLoading: true });\n        const params = { dev };\n        if (force) {\n            params['force'] = 1;\n        }\n        return callApi<ApiResponse<void>>(\"/api/zigbee/remove\", \"DELETE\", params, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    }\n\n\n});\nexport default actions;\n","import { BindRule, Device } from \"./types\";\nimport { ApiResponse, callApi, CallbackHandler } from \"./utils\";\nimport { LogLevel } from \"./components/log-viewer\";\nimport { TimeInfo } from \"./components/discovery/types\";\n\nexport const fetchZigbeeDevicesList = (callback: CallbackHandler<Device[]>): Promise<void> => {\n    return callApi(\"/api/zigbee/devices\", \"GET\", {}, undefined, callback);\n};\nexport const fetchTimeInfo = (callback: CallbackHandler<TimeInfo>): Promise<void> => {\n    return callApi(\"/api/time\", \"GET\", {}, undefined, callback);\n};\nexport const startInterview = (dev: string, state: number | \"\", callback: CallbackHandler<void>): Promise<void> => {\n    return callApi(\"/api/zigbee\", \"POST\", { dev, action: \"setInterview\", state }, undefined, callback);\n};\n\nexport const enableJoin = (duration = 255, target = \"\", callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/zigbee/join\", \"GET\", { duration, target }, undefined, callback);\n};\nexport const clearLogsBuffer = (callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/messages-history\", \"POST\", { action: \"clear\" }, undefined, callback);\n};\n\nexport const fetchLogsBuffer = (callback: CallbackHandler<string>): Promise<void> => {\n    return callApi(\"/api/messages-history\", \"GET\", { action: \"getBuffer\" }, undefined, callback, \"text\");\n};\n\nexport const setLogLevel = (logLevel: LogLevel, callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/messages-history\", \"POST\", { action: \"setLevel\", value: logLevel }, undefined, callback);\n};\n\nexport const getCurrentLogLevel = (callback: CallbackHandler<ApiResponse<LogLevel>>): Promise<void> => {\n    return callApi(\"/api/messages-history\", \"GET\", { action: \"getLevel\" }, undefined, callback);\n};\n\nexport const writeFile = (path: string, content: string, callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/files\", \"POST\", { path }, content, callback);\n};\nexport const evalCode = (code: string, callback: CallbackHandler<ApiResponse<string>>): Promise<void> => {\n    return callApi(\"/api/scripts\", \"POST\", { action: \"evalCode\" }, code, callback);\n};\n\nexport const getDeviceInfo = (dev: string, callback: CallbackHandler<Device>): Promise<void> => {\n    return callApi(\"/api/zigbee/devices\", \"GET\", { dev }, undefined, callback);\n};\nexport const setState = (dev: string, name: string, value: unknown, callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/zigbee\", \"POST\", { dev, action: \"setState\", name, value }, undefined, callback);\n};\nexport const setSimpleBind = (dev: string, name: string, value: unknown, callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/zigbee\", \"POST\", { dev, action: \"setSimpleBind\", name, value }, undefined, callback);\n};\nexport const loadBindsList = (dev: string, callback: CallbackHandler<BindRule[]>): Promise<void> => {\n    return callApi(\"/api/zigbee/bind\", \"GET\", { action: \"list\", dev }, undefined, (err, response: BindRule[]) => {\n        if (err) {\n            callback(true, []);\n        } else {\n            callback(err, response.map((rule, idx) => ({ ...rule, id: idx })));\n        }\n    });\n};\n\n\n\n\n","import { Component, ComponentChild, createRef, h } from \"preact\";\nimport Links from \"./links\";\nimport Nodes from \"./nodes\";\nimport * as d3 from \"d3\";\nimport style from \"./map.css\";\nimport { GraphI, LinkI, NodeI } from \"./types\";\nimport { convert2graph } from \"./convert\";\nimport Tooltip from \"./tooltip\";\nimport { genDeviceDetailsLink } from \"../../utils\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\n\nexport interface MouseEventsResponderNode {\n    onMouseOver?: (arg0: NodeI) => void;\n    onMouseOut?: (arg0: NodeI) => void;\n    onDblClick?: (arg0: NodeI) => void;\n}\n\ninterface MapState {\n    graph: GraphI;\n    tooltipNode: NodeI | false;\n    width: number;\n    height: number;\n}\n\nconst getDistance = (d: LinkI): number => {\n    switch (d.type) {\n        case \"Router2Router\":\n        case \"Router2Coordinator\":\n            return 300;\n        case \"EndDevice2Coordinator\":\n        case \"EndDevice2Router\":\n            return 150;\n        default:\n            return 200;\n    }\n};\n\nexport class Map extends Component<GlobalState & Actions, MapState> {\n    ref = createRef<HTMLDivElement>();\n    simulation!: d3.Simulation<NodeI, LinkI>;\n\n    constructor() {\n        super();\n\n\n        this.simulation = d3.forceSimulation<NodeI>();\n\n        this.state = {\n            width: 0,\n            height: 0,\n            graph: {\n                nodes: [],\n                links: []\n            },\n            tooltipNode: false\n        };\n    }\n\n    updateNodes(): void {\n        this.updateForces();\n        const node = d3.selectAll<SVGGeometryElement, NodeI>(\n            `.${style.node}`\n        );\n        const link = d3.selectAll<SVGLineElement, LinkI>(\n            `.${style.link}`\n        );\n        const linkLabel = d3.selectAll<SVGLineElement, LinkI>(\n            `.${style.linkLabel}`\n        );\n        const ticked = (): void => {\n            const radius = 40;\n            const { width, height } = this.state;\n\n            // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n            // @ts-ignore\n            link.attr(\"d\", (d: LinkI): string => `M ${Math.max(radius, Math.min(width - radius, d.source.x))} ${Math.max(radius, Math.min(height - radius, d.source.y))} L ${Math.max(radius, Math.min(width - radius, d.target.x))} ${Math.max(radius, Math.min(height - radius, d.target.y))}`);\n\n            linkLabel.attr(\"transform\", function(d) {\n                //TODO: add type guard\n                if (((d.target as NodeI).x as number) < ((d.source as NodeI).x as number)) {\n                    const bbox = this.getBBox();\n                    const rx = bbox.x + bbox.width / 2;\n                    const ry = bbox.y + bbox.height / 2;\n                    return `rotate(180 ${rx} ${ry})`;\n                }\n                return \"rotate(0)\";\n            });\n            const imgXShift = 32 / 2;\n            const imgYShift = 32 / 2;\n            node.attr(\"transform\", d => `translate(${Math.max(radius, Math.min(width - radius, d.x)) - imgXShift}, ${Math.max(radius, Math.min(height - radius, d.y)) - imgYShift})`);\n        };\n        const { graph } = this.state;\n        this.simulation.nodes(graph.nodes).on(\"tick\", ticked);\n        const linkForce = this.simulation.force(\"link\") as d3.ForceLink<NodeI,\n            LinkI>;\n        linkForce.links(graph.links);\n        this.simulation.restart();\n    }\n\n    setTooltip = (tooltipNode: NodeI): void => {\n        this.setState({ tooltipNode });\n    };\n\n    removeTooltip = (): void => {\n        this.setState({ tooltipNode: false });\n    };\n\n    openDetailsWindow = (node: NodeI): void => {\n        switch (node.device.type) {\n            case \"EndDevice\":\n            case \"Router\":\n                window.open(genDeviceDetailsLink(node.id));\n                break;\n            default:\n                break;\n        }\n    };\n\n    updateForces(): void {\n        const { width, height } = this.state;\n\n        const linkForce = d3.forceLink<NodeI, LinkI>()\n            .id(d => d.id)\n            .distance(getDistance)\n            .strength(0.2);\n\n        const chargeForce = d3.forceManyBody()\n            .distanceMin(200)\n            .distanceMax(1000)\n            .strength(-200);\n\n        const repelForce = d3.forceManyBody()\n            .strength(-140)\n            .distanceMax(50)\n            .distanceMin(10);\n\n        const collisionForce = d3.forceCollide(40)\n            .strength(1)\n            .iterations(100);\n\n        const centerForce = d3.forceCenter(width / 2, height / 2);\n\n        this.simulation\n            .force(\"link\", linkForce)\n            .force(\"charge\", chargeForce)\n            .force(\"collisionForce\", collisionForce)\n            .force(\"repelForce\", repelForce)\n            .force(\"center\", centerForce);\n    }\n\n    async initPage() {\n        const { getZigbeeDevicesList } = this.props;\n        await getZigbeeDevicesList(true);\n        const { devices } = this.props;\n        const graph = convert2graph(devices);\n        const { width, height } = (this.ref.current as HTMLDivElement).getBoundingClientRect();\n        this.setState({ graph, width, height }, this.updateNodes);\n    }\n\n    componentDidMount(): void {\n        this.initPage().then();\n    }\n\n    render(): ComponentChild {\n        const { width, height, graph, tooltipNode } = this.state;\n        const { time } = this.props;\n        const { setTooltip, removeTooltip, openDetailsWindow } = this;\n        return (\n            <div className={style.container} ref={this.ref}>\n                <svg viewBox={`0 0 ${width} ${height}`}>\n                    <Links links={graph.links} />\n                    <Nodes\n                        nodes={graph.nodes}\n                        simulation={this.simulation}\n                        onMouseOver={setTooltip}\n                        onMouseOut={removeTooltip}\n                        onDblClick={openDetailsWindow}\n                        time={time}\n                    />\n                    {tooltipNode ? (\n                        <foreignObject\n                            className={style.foreignObject}\n                            x={tooltipNode.x as number + 10}\n                            y={tooltipNode.y as number + 5}\n                        >\n                            <Tooltip info={tooltipNode} time={time} />\n                        </foreignObject>\n                    ) : null}\n                </svg>\n            </div>\n        );\n    }\n}\n\nconst mappedProps = [\"time\", \"devices\"];\nconst ConnectedMap = connect<{}, MapState, GlobalState, Actions>(mappedProps, actions)(Map);\nexport default ConnectedMap;\n","import { GATEWAY } from \"./consts\";\nimport { GraphI, LinkType, NodeI } from \"./types\";\nimport { Device, DeviceType } from \"../../types\";\n\nconst getName = (device: Device): string => {\n    const { friendly_name: friendlyName, nwkAddr } = device;\n    if (friendlyName && friendlyName !== \"null\") {\n        return friendlyName;\n    }\n    return nwkAddr;\n};\nexport const convert2graph = (devices: Device[]): GraphI => {\n    const coordinator: NodeI = {\n        id: \"SLS GW\",\n        device: GATEWAY,\n        name: \"GW\"\n    };\n\n    const graph: GraphI = {\n        nodes: [coordinator],\n        links: []\n    };\n    const getLinkType = (source: DeviceType, dest: DeviceType): LinkType => `${source}2${dest}` as LinkType;\n\n    devices.forEach((deviceData) => {\n        graph.nodes.push({\n            id: deviceData.nwkAddr,\n            name: getName(deviceData),\n            device: deviceData\n        });\n        if (Array.isArray(deviceData.Rtg) && deviceData.Rtg.length) {\n            deviceData.Rtg.forEach(route => {\n                graph.links.push({\n                    source: deviceData.nwkAddr,\n                    target: route.toString(),\n                    linkQuality: deviceData?.st?.linkquality,\n                    type: getLinkType(deviceData.type, devices.find(d => d.nwkAddr == route.toString()).type)\n                });\n            });\n        } else {\n            graph.links.push({\n                source: deviceData.nwkAddr,\n                target: coordinator.id,\n                linkQuality: deviceData?.st?.linkquality,\n                type: getLinkType(deviceData.type, \"Coordinator\")\n            });\n        }\n    });\n    return graph;\n};\n","import { Component, ComponentChild, h } from \"preact\";\n\ninterface ButtonProps<T> {\n    item?: T;\n    className?: string;\n\n    onClick?(arg1: T): void;\n}\n\nexport default class Button<T> extends Component<ButtonProps<T>, {}> {\n    onClick = (): void => {\n        const { item, onClick } = this.props;\n        onClick && onClick(item);\n\n    };\n\n    render(): ComponentChild {\n        const { children, ...rest } = this.props;\n        return <button {...rest} onClick={this.onClick}>{children}</button>;\n    }\n}\n\n\nexport class Link<T> extends Component<ButtonProps<T>, {}> {\n    onClick = (): void => {\n        const { item, onClick } = this.props;\n        onClick && onClick(item);\n\n    };\n\n    render(): ComponentChild {\n        const { children, ...rest } = this.props;\n        return <a href=\"#\" {...rest} onClick={this.onClick}>{children}</a>;\n    }\n}","import { Component, ComponentChild, h, Fragment } from \"preact\";\nimport Button from \"../button\";\nimport { Device } from \"../../types\";\nimport { connect } from \"unistore/preact\";\nimport actions, { Actions } from \"../../actions\";\nimport cx from \"classnames\";\ninterface DeviceControlGroupProps {\n    device: Device;\n}\n\nexport class DeviceControlGroup extends Component<DeviceControlGroupProps & Actions, {}> {\n    onBindClick = (): void => {\n        const { device } = this.props;\n        location.href = `/zigbee/device?dev=${encodeURIComponent(device.nwkAddr)}&activeTab=Bind`;\n    };\n\n    onRenameClick = (): void => {\n        const { renameDevice, getZigbeeDevicesList, getDeviceInfo, device } = this.props;\n        const newName = prompt(\"Enter new name\", device.friendly_name);\n        if (newName !== null && newName !== device.friendly_name) {\n            renameDevice(device.nwkAddr, newName).then(() => {\n                getZigbeeDevicesList(true).then();\n                getDeviceInfo(device.nwkAddr);\n            });\n        }\n    };\n\n\n    onRemoveClick = (force = false): void => {\n        const { removeDevice, getZigbeeDevicesList, device } = this.props;\n        const message = force ? \"Remove device?\" : \"Send leave request?\";\n        if (confirm(message)) {\n            removeDevice(device.nwkAddr, force).then(() => {\n                getZigbeeDevicesList(true).then();\n            });\n        }\n    };\n\n    render(): ComponentChild {\n        const { device } = this.props;\n        const validDevice = !!device.ieeeAddr;\n\n        return (\n            <div className=\"btn-group btn-group-sm\" role=\"group\">\n                <Button<void> className=\"btn btn-secondary\" onClick={this.onRenameClick}><i\n                    className=\"fa fa-edit\" /></Button>\n                <Button<void> className=\"btn btn-success\" onClick={this.onBindClick}>Bind</Button>\n                {\n                    <Fragment>\n                        <button type=\"button\" class=\"btn btn-danger dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><i className={cx(\"fa\", \"fa-trash\")} /></button>\n                        <div class=\"dropdown-menu\" aria-labelledby=\"btnGroupDrop1\">\n                            {validDevice ? <a class=\"dropdown-item\" href=\"#\" onClick={(): void => this.onRemoveClick(false)}>Send leave req</a> : null}\n                            <a class=\"dropdown-item\" href=\"#\" onClick={(): void => this.onRemoveClick(true)}>Remove</a>\n                        </div>\n                    </Fragment>\n                }\n            </div>\n        );\n    }\n}\n\nconst mappedProps = [];\nconst ConnectedDeviceControlGroup = connect<DeviceControlGroupProps, {}, {}, Actions>(mappedProps, actions)(DeviceControlGroup);\nexport default ConnectedDeviceControlGroup;\n\n","export enum ZigbeeClusters {\n    // General Clusters\n    ZCL_CLUSTER_ID_GEN_BASIC=                             0x0000,\n    ZCL_CLUSTER_ID_GEN_POWER_CFG=                         0x0001,\n    ZCL_CLUSTER_ID_GEN_DEVICE_TEMP_CONFIG=                0x0002,\n    ZCL_CLUSTER_ID_GEN_IDENTIFY=                          0x0003,\n    ZCL_CLUSTER_ID_GEN_GROUPS=                            0x0004,\n    ZCL_CLUSTER_ID_GEN_SCENES=                            0x0005,\n    ZCL_CLUSTER_ID_GEN_ON_OFF=                            0x0006,\n    ZCL_CLUSTER_ID_GEN_ON_OFF_SWITCH_CONFIG=              0x0007,\n    ZCL_CLUSTER_ID_GEN_LEVEL_CONTROL=                     0x0008,\n    ZCL_CLUSTER_ID_GEN_ALARMS=                            0x0009,\n    ZCL_CLUSTER_ID_GEN_TIME=                              0x000A,\n    ZCL_CLUSTER_ID_GEN_LOCATION=                          0x000B,\n    ZCL_CLUSTER_ID_GEN_ANALOG_INPUT_BASIC=                0x000C,\n    ZCL_CLUSTER_ID_GEN_ANALOG_OUTPUT_BASIC=               0x000D,\n    ZCL_CLUSTER_ID_GEN_ANALOG_VALUE_BASIC=                0x000E,\n    ZCL_CLUSTER_ID_GEN_BINARY_INPUT_BASIC=                0x000F,\n    ZCL_CLUSTER_ID_GEN_BINARY_OUTPUT_BASIC=               0x0010,\n    ZCL_CLUSTER_ID_GEN_BINARY_VALUE_BASIC=                0x0011,\n    ZCL_CLUSTER_ID_GEN_MULTISTATE_INPUT_BASIC=            0x0012,\n    ZCL_CLUSTER_ID_GEN_MULTISTATE_OUTPUT_BASIC=           0x0013,\n    ZCL_CLUSTER_ID_GEN_MULTISTATE_VALUE_BASIC=            0x0014,\n    ZCL_CLUSTER_ID_GEN_COMMISSIONING=                     0x0015,\n    ZCL_CLUSTER_ID_GEN_PARTITION=                         0x0016,\n\n    ZCL_CLUSTER_ID_OTA=                                   0x0019,\n\n    ZCL_CLUSTER_ID_GEN_POWER_PROFILE=                     0x001A,\n    ZCL_CLUSTER_ID_GEN_APPLIANCE_CONTROL=                 0x001B,\n\n    ZCL_CLUSTER_ID_GEN_POLL_CONTROL=                      0x0020,\n\n    ZCL_CLUSTER_ID_GREEN_POWER_PROXY=                     0x0021,\n\n// Closures Clusters,\n    ZCL_CLUSTER_ID_CLOSURES_SHADE_CONFIG=                 0x0100,\n    ZCL_CLUSTER_ID_CLOSURES_DOOR_LOCK=                    0x0101,\n    ZCL_CLUSTER_ID_CLOSURES_WINDOW_COVERING=              0x0102,\n\n// HVAC Clusters,\n    ZCL_CLUSTER_ID_HVAC_PUMP_CONFIG_CONTROL=              0x0200,\n    ZCL_CLUSTER_ID_HVAC_THERMOSTAT=                       0x0201,\n    ZCL_CLUSTER_ID_HVAC_FAN_CONTROL=                      0x0202,\n    ZCL_CLUSTER_ID_HVAC_DIHUMIDIFICATION_CONTROL=         0x0203,\n    ZCL_CLUSTER_ID_HVAC_USER_INTERFACE_CONFIG=            0x0204,\n\n// Lighting Clusters,\n    ZCL_CLUSTER_ID_LIGHTING_COLOR_CONTROL=                0x0300,\n    ZCL_CLUSTER_ID_LIGHTING_BALLAST_CONFIG=               0x0301,\n\n// Measurement and Sensing Clusters,\n    ZCL_CLUSTER_ID_MS_ILLUMINANCE_MEASUREMENT=            0x0400,\n    ZCL_CLUSTER_ID_MS_ILLUMINANCE_LEVEL_SENSING_CONFIG=   0x0401,\n    ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT=            0x0402,\n    ZCL_CLUSTER_ID_MS_PRESSURE_MEASUREMENT=               0x0403,\n    ZCL_CLUSTER_ID_MS_FLOW_MEASUREMENT=                   0x0404,\n    ZCL_CLUSTER_ID_MS_RELATIVE_HUMIDITY=                  0x0405,\n    ZCL_CLUSTER_ID_MS_OCCUPANCY_SENSING=                  0x0406,\n\n// Security and Safety (SS) Clusters,\n    ZCL_CLUSTER_ID_SS_IAS_ZONE=                           0x0500,\n    ZCL_CLUSTER_ID_SS_IAS_ACE=                            0x0501,\n    ZCL_CLUSTER_ID_SS_IAS_WD=                             0x0502,\n// Protocol Interfaces,\n    ZCL_CLUSTER_ID_PI_GENERIC_TUNNEL=                     0x0600,\n    ZCL_CLUSTER_ID_PI_BACNET_PROTOCOL_TUNNEL=             0x0601,\n    ZCL_CLUSTER_ID_PI_ANALOG_INPUT_BACNET_REG=            0x0602,\n    ZCL_CLUSTER_ID_PI_ANALOG_INPUT_BACNET_EXT=            0x0603,\n    ZCL_CLUSTER_ID_PI_ANALOG_OUTPUT_BACNET_REG=           0x0604,\n    ZCL_CLUSTER_ID_PI_ANALOG_OUTPUT_BACNET_EXT=           0x0605,\n    ZCL_CLUSTER_ID_PI_ANALOG_VALUE_BACNET_REG=            0x0606,\n    ZCL_CLUSTER_ID_PI_ANALOG_VALUE_BACNET_EXT=            0x0607,\n    ZCL_CLUSTER_ID_PI_BINARY_INPUT_BACNET_REG=            0x0608,\n    ZCL_CLUSTER_ID_PI_BINARY_INPUT_BACNET_EXT=            0x0609,\n    ZCL_CLUSTER_ID_PI_BINARY_OUTPUT_BACNET_REG=           0x060A,\n    ZCL_CLUSTER_ID_PI_BINARY_OUTPUT_BACNET_EXT=           0x060B,\n    ZCL_CLUSTER_ID_PI_BINARY_VALUE_BACNET_REG=            0x060C,\n    ZCL_CLUSTER_ID_PI_BINARY_VALUE_BACNET_EXT=            0x060D,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_INPUT_BACNET_REG=        0x060E,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_INPUT_BACNET_EXT=        0x060F,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_OUTPUT_BACNET_REG=       0x0610,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_OUTPUT_BACNET_EXT=       0x0611,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_VALUE_BACNET_REG=        0x0612,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_VALUE_BACNET_EXT=        0x0613,\n    ZCL_CLUSTER_ID_PI_11073_PROTOCOL_TUNNEL =      0x0614,\n\n// Advanced Metering Initiative (SE) Clusters,\n    ZCL_CLUSTER_ID_SE_PRICING=                            0x0700,\n    ZCL_CLUSTER_ID_SE_LOAD_CONTROL=                       0x0701,\n    ZCL_CLUSTER_ID_SE_SIMPLE_METERING=                    0x0702,\n    ZCL_CLUSTER_ID_SE_MESSAGE=                            0x0703,\n    ZCL_CLUSTER_ID_SE_SE_TUNNELING=                       0x0704,\n    ZCL_CLUSTER_ID_SE_PREPAYMENT=                         0x0705,\n    ZCL_CLUSTER_ID_SE_ENERGY_MGMT=                        0x0706,\n    ZCL_CLUSTER_ID_SE_TOU_CALENDAR=                       0x0707,\n    ZCL_CLUSTER_ID_SE_DEVICE_MGMT=                        0x0708,\n    ZCL_CLUSTER_ID_SE_EVENTS=                             0x0709,\n    ZCL_CLUSTER_ID_SE_MDU_PAIRING=                        0x070A,\n\n    ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT=                 0x0800,\n\n    ZCL_CLUSTER_ID_HA_APPLIANCE_IDENTIFICATION=           0x0B00,\n    ZCL_CLUSTER_ID_HA_METER_IDENTIFICATION=               0x0B01,\n    ZCL_CLUSTER_ID_HA_APPLIANCE_EVENTS_ALERTS=            0x0B02,\n    ZCL_CLUSTER_ID_HA_APPLIANCE_STATISTICS=               0x0B03,\n    ZCL_CLUSTER_ID_HA_ELECTRICAL_MEASUREMENT=             0x0B04,\n    ZCL_CLUSTER_ID_HA_DIAGNOSTIC=                         0x0B05,\n\n// Light Link cluster\n    ZCL_CLUSTER_ID_LIGHT_LINK=                           0x1000\n}\n","import { Component, ComponentChild, h } from \"preact\";\n\ninterface SafeImgState {\n    isOk: boolean;\n}\n\ninterface SafeImgProps {\n    [k: string]: any;\n}\n\nexport default class SafeImg extends Component<SafeImgProps, SafeImgState> {\n    constructor() {\n        super();\n        this.state = {\n            isOk: true\n        };\n    }\n\n    onError = (): void => {\n        this.setState({\n            isOk: false\n        });\n\n    };\n\n    render(): ComponentChild {\n        const { children, ...rest } = this.props;\n        const { isOk } = this.state;\n        return isOk ? <img {...rest} onError={this.onError} /> : children;\n    }\n}","import { Fragment, FunctionalComponent, h } from \"preact\";\nimport { PowerSource } from \"../../types\";\nimport style from \"./style.css\";\nimport { bitOps } from \"../../utils\";\n\ninterface PowerSourceProps {\n    source: PowerSource;\n    battery?: number;\n    className?: string;\n}\nconst description = [\n    \"Unknown\",\n    \"Mains (single phase)\",\n    \"Mains (3 phase)\",\n    \"Battery\",\n    \"DC source\",\n    \"Emergency mains constantly powered\",\n    \"Emergency mains and transfer switch\"\n];\n\nconst PowerSourceComp: FunctionalComponent<PowerSourceProps> = ({ source, battery,className }) => {\n    let batteryClass = \"fa-battery-full\";\n    //Bit b7 of this attribute SHALL be set to 1 if the device has a secondary power source in the form of a battery\n    // backup. Otherwise, bit b7 SHALL be set to 0.\n    const hasSecondaryPowerSource = bitOps.getBit(source, 7) == 1;\n    if (hasSecondaryPowerSource) {\n        source = bitOps.clearBit(source, 7);\n    }\n\n    switch (source) {\n        case PowerSource.Battery:\n            if (battery) {\n                if (battery > 75) {\n                    batteryClass = \"fa-battery-full\";\n                } else if (battery >= 75) {\n                    batteryClass = \"fa-battery-three-quarters\";\n                } else if (battery >= 50) {\n                    batteryClass = \"fa-battery-half\";\n                } else if (battery >= 25) {\n                    batteryClass = \"fa-battery-quarter\";\n                } else {\n                    batteryClass =\"fa-battery-empty\"\n                }\n            }\n            return <i className={`fa ${batteryClass} ${className}`}\n                      title={`${description[source]} ${battery ? `, power level ${battery}%` : \"\"} `} />;\n\n        case PowerSource.EmergencyMains:\n        case PowerSource.MainsThreePhase:\n        case PowerSource.EmergencyMainsConstantPower:\n        case PowerSource.MainsSinglePhase:\n            return (<Fragment>\n                <i className={`fa fa-plug ${style.plug} ${className}`} title={description[source]} />\n                {hasSecondaryPowerSource ? <PowerSourceComp className={'d-block'} source={PowerSource.Battery} battery={battery} /> : null }\n            </Fragment>);\n        case PowerSource.DC:\n            return (<Fragment>\n                <i class={`fa fa-charging-station ${className}`} title={description[source]} />\n                {hasSecondaryPowerSource ? <PowerSourceComp className={'d-block'} source={PowerSource.Battery} battery={battery} /> : null }\n            </Fragment>);\n\n        case PowerSource.Unknown:\n        default:\n            return <i className={`fa fa-question ${className}`} title={description[0]} />;\n    }\n};\n\nexport default PowerSourceComp;\n","import { Component, ComponentChild, h } from \"preact\";\nimport style from \"./style.css\";\nimport { SortDirection } from \"../../types\";\n\n\n\ninterface ActionTHProps<T> {\n    column: T;\n    current: T;\n    currentDirection: SortDirection;\n\n    onClick?(arg1: unknown): void;\n\n    [k: string]: unknown;\n}\n\nexport default class ActionTH<T> extends Component<ActionTHProps<T>, {}> {\n    onClick = (event: MouseEvent): void => {\n        event.preventDefault();\n        event.stopPropagation();\n        const { column, onClick } = this.props;\n        onClick && onClick(column);\n    };\n\n    renderArrow(): ComponentChild {\n        const { currentDirection, current, column } = this.props;\n        if (current === column) {\n            if (currentDirection == \"asc\") {\n                return <i className={`fa fa-sort-amount-down-alt`} />;\n            } else  {\n                return <i className={`fa fa-sort-amount-down`} />;\n            }\n\n        }\n        return <i className={`fa fa-sort-amount-down ${style.invisible}`} />;\n\n    }\n\n    render(): ComponentChild {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { children, onClick, current, column, ...rest } = this.props;\n        return <th {...rest}>\n            <a href=\"#\" onClick={this.onClick}>{children}</a>\n            {this.renderArrow()}\n        </th>;\n    }\n}","import style from \"./style.css\";\nimport { Component, ComponentChild, h } from \"preact\";\nimport Button from \"../button\";\nimport orderBy from \"lodash/orderBy\";\nimport debounce from \"lodash/debounce\";\nimport DeviceControlGroup from \"../device-control\";\nimport cx from \"classnames\";\nimport { Device, DeviceSupportStatus, inteviewsCount, SortDirection } from \"../../types\";\nimport { genDeviceDetailsLink, genDeviceImageUrl, lastSeen, WSConnect } from \"../../utils\";\nimport SafeImg from \"../safe-image\";\nimport { Notyf } from \"notyf\";\nimport PowerSource from \"../power-source\";\nimport { WebsocketMessage, ZigbeePayload } from \"../discovery/types\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\nimport ActionTH from \"./ActionTH\";\nimport { isLeaveReqSend } from \"../../binaryUtils\";\n\n//TODO: proper type alias\ntype SortColumns =\n    \"last_seen\"\n    | \"nwkAddr\"\n    | \"friendly_name\"\n    | \"ieeeAddr\"\n    | \"ManufName\"\n    | \"st.linkquality\"\n    | \"ModelId\"\n    | \"Interview.State\"\n    | \"PowerSource\";\n\n\ninterface ZigbeeTableState {\n    sortDirection: SortDirection;\n    sortColumn: SortColumns;\n}\n\n\n\n\nconst storeKey = \"ZigbeeTableState\";\n\nexport class ZigbeeTable extends Component<Actions & GlobalState, ZigbeeTableState> {\n    constructor() {\n        super();\n        this.state = {\n            sortDirection: \"desc\",\n            sortColumn: \"last_seen\"\n        };\n    }\n\n    restoreState(): void {\n        const storedState = localStorage.getItem(storeKey);\n        if (storedState) {\n            try {\n                const restored: Partial<ZigbeeTableState> = JSON.parse(storedState);\n                this.setState(restored);\n            } catch (e) {\n                new Notyf().error(e.toString());\n            }\n        }\n    }\n\n    saveState = (): void => {\n        const { sortDirection, sortColumn } = this.state;\n        const storeData = {\n            sortDirection,\n            sortColumn\n        };\n        //in private mode localstorage access can throw exceptions\n        try {\n            localStorage.setItem(storeKey, JSON.stringify(storeData));\n        } catch (e) {\n            new Notyf().error(e.toString());\n        }\n    };\n\n    loadData = (showLoading = true): void => {\n        const {getZigbeeDevicesList, fetchTimeInfo} = this.props;\n        getZigbeeDevicesList(showLoading);\n        fetchTimeInfo();\n    };\n\n    debouncedLoadData = debounce(() => this.loadData(false), 1000);\n\n    onMessageReceive = (wsEvent: MessageEvent): void => {\n        let event = {} as WebsocketMessage;\n        try {\n            event = JSON.parse(wsEvent.data) as WebsocketMessage;\n        } catch (e) {\n            new Notyf().error(`Cant parse json ${e}`);\n        }\n        if (event.category == \"zigbee\") {\n            const payload  = event.payload as ZigbeePayload;\n            if(payload.event == \"LinkData\") {\n                this.debouncedLoadData();\n            }\n        }\n\n    };\n    initWs(): void {\n        const ws = WSConnect();\n        ws.addEventListener(\"open\", () => {\n            ws.send(JSON.stringify({ action: \"subscribe\", category: \"zigbee\" }));\n        });\n        ws.addEventListener(\"message\", this.onMessageReceive);\n    }\n\n    componentDidMount(): void {\n        this.restoreState();\n        this.loadData();\n        this.initWs();\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    onInterviewClick = (device: Device): void => {\n        const { startInterview } = this.props;\n        if (confirm(\"Start Interview?\")) {\n            startInterview(device.nwkAddr, device?.Interview?.State)\n                .then(() => new Notyf().success(\"Started interview\"));\n        }\n    };\n\n    onSortChange = (column: SortColumns, sortDir: SortDirection | undefined = undefined): void => {\n        const { sortColumn } = this.state;\n        let { sortDirection } = this.state;\n\n        if (sortColumn === column) {\n            if (sortDir) {\n                sortDirection = sortDir;\n            } else if (sortDirection == \"asc\") {\n                sortDirection = \"desc\";\n            } else {\n                sortDirection = \"asc\";\n            }\n        }\n\n        this.setState({ sortColumn: column, sortDirection }, this.saveState);\n    };\n\n    render(): ComponentChild {\n        const { devices, isLoading } = this.props;\n        if (isLoading) {\n            return <div className=\"d-flex justify-content-center\">\n                <div className=\"spinner-border\" role=\"status\">\n                    <span className=\"sr-only\">Loading...</span>\n                </div>\n            </div>;\n        }\n        return (devices.length ? this.renderDevicesTable() : <div>No data</div>);\n    }\n\n    renderInterviewState(device: Device): ComponentChild {\n        const { onInterviewClick } = this;\n        const interviewTrigger = <Button<Device> className=\"btn btn-normal btn-sm\" onClick={onInterviewClick}\n                                                 item={device}><i className=\"fa fa-play\" /></Button>;\n\n        if (device.Interview) {\n            if (inteviewsCount === device.Interview.State) {\n                return \"Ok\";\n            }\n            return <div>{device.Interview.State ?? 0}/{inteviewsCount} {interviewTrigger}</div>;\n        }\n        return <div>N/A {interviewTrigger}</div>;\n    }\n\n    getSupportTitle(device: Device): string {\n        switch (device.supported) {\n            case DeviceSupportStatus.Supported:\n                return \"Supported\";\n            case DeviceSupportStatus.Unknown:\n                return \"Support unknown\";\n            case DeviceSupportStatus.UnSupported:\n                return \"Unsupported\";\n            default:\n                return \"\";\n        }\n    }\n\n    renderDevicesTable(): ComponentChild {\n        const { sortColumn, sortDirection } = this.state;\n        const { time, devices } = this.props;\n        const sortedDevices = orderBy<Device>(devices, [sortColumn], [sortDirection]);\n        const { onSortChange } = this;\n\n        return (\n            <table className={`table table-striped table-borderless ${style.adaptive} ${style.zigbee}`}>\n                <thead>\n                <tr className=\"text-nowrap\">\n                    <th>#</th>\n                    <th>Pic</th>\n                    <ActionTH<SortColumns> className={cx(style[\"nwk-addr\"], style[\"action-column\"])} column=\"nwkAddr\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>nwkAddr</ActionTH>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"friendly_name\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>FriendlyName</ActionTH>\n                    <ActionTH<SortColumns> className={cx(style[\"ieee-addr\"], style[\"action-column\"])} column=\"ieeeAddr\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>ieeeAddr</ActionTH>\n                    <ActionTH<SortColumns> className={cx(style[\"manu-name\"], style[\"action-column\"])} column=\"ManufName\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange} titile=\"ManufName\">Manuf</ActionTH>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"ModelId\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>ModelId</ActionTH>\n\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"st.linkquality\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange} title=\"Link quality\">Link</ActionTH>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"Interview.State\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>Interview</ActionTH>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"last_seen\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>LastSeen</ActionTH>\n                    <th>Routes</th>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"PowerSource\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>PS</ActionTH>\n                    <th>Actions</th>\n                </tr>\n                </thead>\n                <tbody>\n                {sortedDevices.map((device: Device, index) => <tr className={cx({\n                    \"table-danger\": !device.ieeeAddr,\n                    \"table-warning\": isLeaveReqSend(device.flags)\n                })}>\n                    <td className=\"font-weight-bold\">{index + 1}</td>\n                    <td className={style[\"device-pic\"]}><SafeImg class={cx(style[\"device-image\"])}\n                                                                 src={genDeviceImageUrl(device)} />\n                    </td>\n                    <td className={style[\"nwk-addr\"]}><a\n                        href={genDeviceDetailsLink(device.nwkAddr)}>{device.nwkAddr}</a>\n                    </td>\n                    <td>{device.friendly_name}</td>\n                    <td className={style[\"ieee-addr\"]}>{device.ieeeAddr ? device.ieeeAddr : \"<corrupted>\"}</td>\n                    <td title={device.ManufName}\n                        className={cx(style[\"manu-name\"], \"text-truncate\", \"text-nowrap\", \"position-relative\")}>{device.ManufName}</td>\n                    <td title={this.getSupportTitle(device)} className={cx(\"text-nowrap\", {\n                        \"table-danger\": device.supported == DeviceSupportStatus.UnSupported,\n                        \"table-warning\": device.supported == DeviceSupportStatus.Unknown\n                    })}>{device.ModelId}</td>\n                    <td>{device.st?.linkquality}</td>\n                    <td className={cx({\n                        \"table-warning\": device.Interview?.State !== 4\n                    })}>{this.renderInterviewState(device)}</td>\n                    <td>{lastSeen(device, time)}</td>\n                    <td>{device?.Rtg?.map((route) => <a className={\"d-block\"}\n                        href={genDeviceDetailsLink(route)}>{route}</a>)}</td>\n                    <td className=\"text-left\"><PowerSource source={device.PowerSource} battery={device.st?.battery} /></td>\n                    <td>\n                        <DeviceControlGroup device={device} />\n                    </td>\n                </tr>)}\n\n                </tbody>\n            </table>\n\n        );\n    }\n}\n\nconst mappedProps = [\"isLoading\", \"time\", \"devices\"];\nconst ConnectedDevicePage = connect<{}, ZigbeeTableState, GlobalState, Actions>(mappedProps, actions)(ZigbeeTable);\nexport default ConnectedDevicePage;\n","export const isLeaveReqSend = (flags: number): boolean => {\n    return !!(flags & 0x01);\n}","import { Component, ComponentChild, Fragment, FunctionalComponent, h, VNode } from \"preact\";\n\nimport style from \"./style.css\";\nimport { genDeviceDetailsLink, genDeviceImageUrl, last } from \"../../utils\";\nimport cx from \"classnames\";\nimport { ZigbeeEvent, ZigbeePayload } from \"./types\";\nimport groupBy from \"lodash/groupBy\";\nimport { Device, Dictionary } from \"../../types\";\nimport DeviceControlGroup from \"../device-control\";\nimport Button from \"../button\";\nimport SafeImg from \"../safe-image\";\nimport PowerSourceComp from \"../power-source\";\nimport uniqWith from \"lodash/uniqWith\";\nimport isEqual from \"lodash/isEqual\";\n\nconst INTERVIEW_STEPS_COUNT = 9;\nconst DEVICE_NOT_RESPONDING_TIMEOUT = 20;\nconst DEVICE_MANUAL_WAKEUP_TIMEOUT = 5;\n\ninterface DeviceCardProps {\n    ieeeAddr: string;\n    events: ZigbeePayload[];\n\n    startInterview(nwkAddr: string, state: number): void;\n}\n\nconst EventLabels = new Map<ZigbeeEvent, string>([\n    [\"LeaveInd\", \"Left network\"],\n    [\"TcDeviceInd\", \"Device joined\"],\n    [\"DeviceAnnceInd\", \"Announce received\"],\n    [\"SimpleDescRsp\", \"Clusters received\"],\n    [\"ActiveEpRsp\", \"Endpoints received\"],\n    [\"ModelRcv\", \"Model received\"],\n    [\"NodeDescRsp\", \"Processing interviews\"],\n    [\"PowerSrcRcv\", \"Power source received\"],\n    [\"ConfRsp\", \"Finished interview\"]\n]);\n\nconst RowCol: FunctionalComponent<{ title: string; content: ComponentChild }> = ({ title, content }) => {\n    return (\n        <div class={`row ${style[\"scale-in-center\"]}`}>\n            <div class=\"col-5 text-nowrap\">{title}</div>\n            <div class=\"col\">{content}</div>\n        </div>\n    );\n};\n\ninterface EventRowProps {\n    eventName: ZigbeeEvent;\n    events: ZigbeePayload[];\n}\n\nconst EventRow: FunctionalComponent<EventRowProps> = ({ eventName, events }): VNode<any> => {\n    switch (eventName) {\n        case \"LeaveInd\":\n            return (\n                <RowCol title=\"Old nwkAddr:\" content={<del>{last(events).nwkAddr}</del>} />\n            );\n\n\n        case \"TcDeviceInd\":\n            return (\n                <Fragment>\n                    <RowCol title=\"New nwkAddr:\" content={last(events).nwkAddr} />\n                    {\n                        last(events).ParentnwkAddr ? (\n                            <RowCol title=\"ParentnwkAddr:\" content={last(events).ParentnwkAddr} />\n                        ) : null\n                    }\n                </Fragment>\n            );\n\n\n        case \"DeviceAnnceInd\":\n            return <RowCol title=\"Type:\" content={last(events).type} />;\n\n\n        case \"PowerSrcRcv\":\n            return <RowCol title=\"Power source:\" content={<PowerSourceComp source={last(events).PowerSource} />} />;\n\n        case \"SimpleDescRsp\":\n            return <Fragment>\n                {uniqWith(events\n                        .filter(e => e.ep)\n                        .map(({ ep, ProfileId, DeviceId }) => ({ ep, ProfileId, DeviceId }))\n                    , isEqual)\n                    .map(evt => (\n                        <RowCol title={`Endpoint #${evt.ep}:`}\n                                content={`ProfileId=${evt.ProfileId} DeviceId=${evt.DeviceId}`} />\n                    ))}\n            </Fragment>;\n\n\n        case \"ModelRcv\":\n            return (\n                <Fragment>\n                    <RowCol title=\"ManufName:\" content={last(events).ManufName || <small>detecting...</small>} />\n                    <RowCol title=\"Model:\" content={\n                        <Fragment>\n                            <div>{last(events).ModelId}</div>\n                            <SafeImg class={cx(style[\"device-image\"])}\n                                     src={genDeviceImageUrl({ ModelId: last(events).ModelId } as Device)\n                                     } />\n                        </Fragment>\n                    } />\n                </Fragment>\n            );\n\n        default:\n            return undefined;\n\n    }\n};\n\ninterface DeviceCardState {\n    currentTimestamp: number;\n    updateTimerId: number;\n    manualInterviewStarted: boolean;\n    isDone: boolean;\n}\n\nexport default class DeviceCard extends Component<DeviceCardProps, DeviceCardState> {\n    constructor() {\n        super();\n        const updateTimerId = window.setInterval(() => {\n            this.setState({ currentTimestamp: Date.now() });\n        }, 1000);\n\n\n        this.state = {\n            isDone: false,\n            manualInterviewStarted: false,\n            updateTimerId,\n            currentTimestamp: Date.now()\n        };\n    }\n\n    getLastEvent(): ZigbeePayload {\n        const { events } = this.props;\n        return events[events.length - 1];\n    }\n\n    getLastUpdateTime(): number {\n        const { timestamp: messageTimestamp } = this.getLastEvent();\n        const { currentTimestamp } = this.state;\n        return Math.max(0, Math.round((currentTimestamp - messageTimestamp) / 1000));\n    }\n\n    getLastUpdateTimeMessage(): string {\n        const lastMessage = this.getLastUpdateTime();\n        return `${lastMessage} sec ago`;\n    }\n\n    getInterviewText(): string {\n        const lastEvent = this.getLastEvent();\n        return EventLabels.get(lastEvent.event);\n    }\n\n    onInterviewClick = (nwkAddr: string): void => {\n        const { startInterview } = this.props;\n        startInterview(nwkAddr, 0);\n        this.setState({manualInterviewStarted: true});\n    };\n\n    renderManualInterviewHelper(): ComponentChild {\n        const { manualInterviewStarted } = this.state;\n        const { ieeeAddr } = this.props;\n\n        const lastUpdateTime = this.getLastUpdateTime();\n        if (manualInterviewStarted && lastUpdateTime > DEVICE_MANUAL_WAKEUP_TIMEOUT) {\n            return (<div class={`row ${style[\"scale-in-center\"]}`}>\n                <div class={`col-12 ${style.blink}`}>Press wakeup button</div>\n            </div>);\n        }\n        if (!manualInterviewStarted && lastUpdateTime > DEVICE_NOT_RESPONDING_TIMEOUT)\n            return (\n                <div class={`row ${style[\"scale-in-center\"]}`}>\n                    <div class=\"col-5\">Start interview:</div>\n                    <div class=\"col\">\n                        <Button<string> className=\"btn btn-normal btn-sm\" onClick={this.onInterviewClick}\n                                        item={ieeeAddr}><i className=\"fa fa-play\" /></Button>\n                    </div>\n                </div>\n            );\n    }\n\n    // eslint-disable-next-line react/no-deprecated\n    componentWillReceiveProps(nextProps: Readonly<DeviceCardProps>, nextContext: any): void {\n        const { events } = nextProps;\n        const lastEvent = events[events.length - 1];\n        const { updateTimerId } = this.state;\n        if (lastEvent && lastEvent.event === \"PowerSrcRcv\") {\n            // progressValue = 100;\n            window.clearInterval(updateTimerId);\n            this.setState({ isDone: true });\n        }\n    }\n\n    render(): ComponentChild {\n\n        const { isDone } = this.state;\n        const { events, ieeeAddr } = this.props;\n        const groupedEvents = groupBy(events, \"event\") as Dictionary<ZigbeePayload[]>;\n        const eventsCount = Object.keys(groupedEvents).length;\n        const progressValue = Math.round(100 / INTERVIEW_STEPS_COUNT * eventsCount);\n\n        return (\n            <div className={cx(\"card\", \"col-sm-4\", style[\"discovery-card\"], style[\"scale-in-center\"])}>\n                <div class=\"card-header\">\n                    Device <a href={genDeviceDetailsLink(ieeeAddr)}>{ieeeAddr}</a>\n                    <p class=\"card-text\"><small class=\"text-muted\">\n                        {isDone ? \"Successfully joined!\" : `Last updated ${this.getLastUpdateTimeMessage()}`}</small>\n                    </p>\n                </div>\n                <div className=\"card-body\">\n                    {!isDone ? (<p className=\"card-text\">\n                        <div className=\"progress\">\n                            <div className=\"progress-bar progress-bar-striped progress-bar-animated\"\n                                 style={`width: ${progressValue}%;`} aria-valuenow={progressValue} aria-valuemin=\"0\"\n                                 aria-valuemax=\"100\">{progressValue}%\n                            </div>\n                        </div>\n                    </p>) : null}\n\n\n                    <div class={`row ${style[\"scale-in-center\"]}`}>\n                        <div class=\"col-5\">Current status:</div>\n                        <div class=\"col\">{this.getInterviewText()}</div>\n                    </div>\n\n                    {\n                        Object.entries(groupedEvents).map(([eventName, events]) => ((\n                            <EventRow key={eventName} eventName={eventName as ZigbeeEvent} events={events} />)))\n                    }\n                    {\n                        isDone ? null : this.renderManualInterviewHelper()\n                    }\n                </div>\n                {isDone ? <div className=\"card-footer\">\n                    <DeviceControlGroup device={{ nwkAddr: ieeeAddr, ieeeAddr } as Device} />\n                </div> : null}\n            </div>\n        );\n    }\n}","import { Component, ComponentChild, h } from \"preact\";\nimport { BindRule, Device } from \"../../types\";\nimport { ZigbeeClusters } from \"./clusters\";\nimport BindRow from \"./bind-row\";\nimport actions, { Actions } from \"../../actions\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport { Notyf } from \"notyf\";\n\n\nexport const getClusterName = (id: number, addBraces = true): string => {\n    if (ZigbeeClusters[id]) {\n        const cleanName = (ZigbeeClusters[id] as string).replace(/^ZCL_CLUSTER_ID_/, \"\");\n        return addBraces ? ` (${cleanName})` : cleanName;\n    }\n    return \"\";\n};\n\ninterface PropsFromStore {\n    device: Device;\n    devices: Device[];\n    bindRules: BindRule[];\n}\n\nexport class Bind extends Component<PropsFromStore & Actions, {}> {\n    onRuleChange = (idx: number, rule: BindRule): void => {\n        const { bindRules, setBindRules } = this.props;\n        const copyRules = [...bindRules];\n        copyRules[idx] = rule;\n        setBindRules(copyRules);\n    };\n\n    onBindClick = async (rule: BindRule) => {\n        const { device, createBind, getDeviceBinds } = this.props;\n        await createBind(device.nwkAddr, rule)\n        new Notyf().success(`Created bind rule`);\n        getDeviceBinds(device.nwkAddr);\n\n    };\n\n    onUnBindClick = async (rule: BindRule) => {\n        const { device, removeBind, getDeviceBinds } = this.props;\n        await removeBind(device.nwkAddr, rule);\n        new Notyf().success(`Removed bind rule`);\n        getDeviceBinds(device.nwkAddr);\n    };\n\n    renderBindsTable(): ComponentChild {\n        const { bindRules, devices, device } = this.props;\n        return (\n            <table class=\"table table-striped table-borderless\">\n                <thead>\n                <tr>\n                    <th scope=\"col\">#</th>\n                    <th scope=\"col\">Source Cluster/Ep</th>\n                    <th scope=\"col\">DstNwkAddr</th>\n                    <th scope=\"col\">DstEp</th>\n                    <th scope=\"col\">Action</th>\n                </tr>\n                </thead>\n                <tbody>\n                {\n                    bindRules.map((rule, idx) => <BindRow\n                        key={idx}\n                        onUnBindClick={this.onUnBindClick}\n                        onBindClick={this.onBindClick}\n                        onChange={this.onRuleChange}\n                        device={device}\n                        idx={idx}\n                        rule={rule}\n                        devices={devices} />)\n                }\n                </tbody>\n            </table>\n        );\n    }\n\n    render(): ComponentChild {\n        const { device } = this.props;\n        if (device) {\n            return this.renderBindsTable();\n        } else {\n            return \"Loading...\";\n        }\n    }\n}\n\nconst mappedProps = [\"device\", \"devices\", \"bindRules\"];\n\nexport default connect<{}, {}, GlobalState, PropsFromStore>(mappedProps, actions)(Bind);","import { Component, ComponentChild, h } from \"preact\";\nimport flatten from \"lodash/flatten\";\nimport cx from \"classnames\";\nimport { toHex } from \"../../utils\";\nimport { getClusterName } from \"./bind\";\nimport { BindRule, Device } from \"../../types\";\n\nconst fields = [\"DstNwkAddr\", \"ClusterId\", \"SrcEp\", \"DstEp\"];\n\nfunction isValidBindRule(rule: BindRule): rule is BindRule {\n    return fields.some(key => rule[key] !== undefined);\n}\nexport const getDeviceDisplayName = (device: Device): string => {\n    return `${device.nwkAddr} (${device.friendly_name ? device.friendly_name : device.ModelId})`;\n};\ninterface BindRowProps {\n    onChange?(idx: number, rule: BindRule): void;\n\n    onBindClick?(rule: BindRule): void;\n\n    onUnBindClick?(rule: BindRule): void;\n\n    idx: number;\n    rule: BindRule;\n    devices: Device[];\n    device: Device;\n}\n\nexport default class BindRow extends Component<BindRowProps, {}> {\n\n\n    isExistingBinding(): boolean {\n        const { rule } = this.props;\n        return rule.id !== undefined;\n    }\n\n    onDstChange = (evt) => {\n        const { idx, rule, onChange } = this.props;\n        const { value } = evt.target;\n        onChange && onChange(idx, { ...rule, DstNwkAddr: value, DstEp: undefined });\n    };\n\n    renderDstSelect(): ComponentChild {\n        const { devices, rule, device } = this.props;\n        const options = devices\n            .filter(d => d.nwkAddr !== device.nwkAddr) //exclude self from select\n            .filter(d => {\n                const inC = flatten(Object.values(d.ep ?? {}).map(ep => Object.keys(ep.In ?? {}).map(c => parseInt(c, 10))));\n                return inC.includes(rule.ClusterId);\n            })\n            .map(device => <option selected={device.nwkAddr === rule.DstNwkAddr}\n                                   value={device.nwkAddr}>{getDeviceDisplayName(device)}</option>);\n\n        options.unshift(<option hidden>Select device ({options.length})</option>);\n\n        return <select disabled={this.isExistingBinding()} onChange={this.onDstChange}\n                       class={cx(\"form-control\", { \"form-control-plaintext\": this.isExistingBinding() })}>{options}</select>;\n    }\n\n\n    onClusterChange = (evt): void => {\n        const { onChange, rule, idx } = this.props;\n        const { value } = evt.target;\n        const [SrcEp, ClusterId] = value.split(\",\").map(p => parseInt(p, 10));\n        onChange && onChange(idx, { ...rule, SrcEp, ClusterId, DstNwkAddr: undefined });\n    };\n\n    renderClusterId(): ComponentChild {\n        const { device, rule } = this.props;\n        const optionGroups = Object.entries(device.ep ?? {}).map(([epNumber, ep]) => {\n            const clusters = Object.keys(ep.Out ?? {}).map(c => parseInt(c, 10));\n            return <optgroup label={`Endpoint: #${epNumber}`}>\n                {clusters.map(c => <option selected={c === rule.ClusterId && parseInt(epNumber, 10) == rule.SrcEp}\n                                           value={[epNumber, c.toString()]}>{toHex(c, 4)}{getClusterName(c, true)}</option>)}\n            </optgroup>;\n        });\n        optionGroups.unshift(<option hidden>Select cluster</option>);\n\n        return <select disabled={this.isExistingBinding()} onChange={this.onClusterChange}\n                       class={cx(\"form-control\", { \"form-control-plaintext\": this.isExistingBinding() })}>{optionGroups}</select>;\n    }\n\n    onDstEpChange = (evt) => {\n        const { onChange, rule, idx } = this.props;\n        const { value } = evt.target;\n        onChange && onChange(idx, { ...rule, DstEp: parseInt(value, 10) });\n    };\n\n    renderDstEp(): ComponentChild {\n        const { devices, rule } = this.props;\n        const dstDevice = devices.find((d) => d.nwkAddr === rule.DstNwkAddr);\n\n        let options = [];\n\n        if (dstDevice) {\n            const dstEndpoints = Object.entries(dstDevice.ep ?? {})\n                .filter(([epName, ep]) => Object.prototype.hasOwnProperty.call(ep.In, rule.ClusterId.toString()));\n            options = options.concat(dstEndpoints.map(([epName, ep]) => <option\n                selected={parseInt(epName, 10) === rule.DstEp} value={epName}>{epName}</option>));\n        }\n        options.unshift(<option hidden>Select destination ({options.length})</option>);\n\n        return <select disabled={this.isExistingBinding()} onChange={this.onDstEpChange}\n                       class={cx(\"form-control\", { \"form-control-plaintext\": this.isExistingBinding() })}>{options}</select>;\n\n    }\n\n    onBindClick = (): void => {\n        const { onBindClick, rule } = this.props;\n        onBindClick && onBindClick(rule);\n    };\n    onUnBindClick = (): void => {\n        const { onUnBindClick, rule } = this.props;\n        onUnBindClick && onUnBindClick(rule);\n    };\n\n    renderActionButton(): ComponentChild {\n        const { rule } = this.props;\n        return (\n            this.isExistingBinding() ? (\n                <button onClick={this.onUnBindClick} type=\"button\" class=\"btn btn-danger w-100\">Unbind</button>\n            ) : (\n                <button disabled={!isValidBindRule(rule)} onClick={this.onBindClick} type=\"button\"\n                        class=\"btn btn-primary w-100\">Bind</button>\n            )\n\n        );\n    }\n\n    render(): ComponentChild {\n        const { idx } = this.props;\n        return (\n            <tr>\n                <th scope=\"row\">{idx + 1}</th>\n                <td>{this.renderClusterId()}</td>\n                <td>{this.renderDstSelect()}</td>\n                <td>{this.renderDstEp()}</td>\n                <td>{this.renderActionButton()}</td>\n            </tr>\n        );\n    }\n}","import { Component, ComponentChild, Fragment, h } from \"preact\";\nimport { Dictionary } from \"../../types\";\nimport { ZigbeePayload } from \"./types\";\nimport DeviceCard from \"./device-card\";\nimport Button from \"../button\";\nimport { Notyf } from \"notyf\";\nimport orderBy from \"lodash/orderBy\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\nimport WebsocketManager from \"../../websocket\";\nimport { getDeviceDisplayName } from \"../device-page/bind-row\";\nwindow[\"wsEventsData\"] = window[\"wsEventsData\"] || [];\nconst wsEventsData: object[] = window['wsEventsData'];\n\ninterface DiscoveryState {\n    targetRouter: string;\n    updateTimerId: number;\n    joinDuration: number;\n    events: Dictionary<ZigbeePayload[]>;\n}\n\nexport class Discovery extends Component<GlobalState & Actions, DiscoveryState> {\n    constructor() {\n        super();\n\n        this.state = {\n            targetRouter: '0x0000',\n            updateTimerId: 0,\n            joinDuration: 0,\n            events: {}\n        };\n\n    }\n\n    processZigbeeEvent = ({ category, payload }): void => {\n        wsEventsData.push({ category, payload })\n\n        const message = { ...payload };\n        // console.log(\"processZigbeeEvent\", message);\n        message.timestamp = Date.now();\n        const { events } = this.state;\n        const { ieeeAddr } = message;\n        let { joinDuration, updateTimerId } = this.state;\n        switch (message.event) {\n            case \"LinkData\":\n                break;\n            case \"PermitJoin\":\n                joinDuration = message.duration;\n                window.clearInterval(updateTimerId);\n                updateTimerId = window.setInterval(() => {\n                    const { joinDuration, updateTimerId } = this.state;\n                    if (joinDuration <= 0) {\n                        window.clearInterval(updateTimerId);\n                    } else {\n                        this.setState({ joinDuration: joinDuration - 1 });\n                    }\n\n                }, 1000);\n                break;\n            default:\n                if (events[ieeeAddr]) {\n                    events[ieeeAddr].push(message);\n                } else {\n                    events[ieeeAddr] = [message];\n                }\n                break;\n\n        }\n        this.setState({ events, joinDuration, updateTimerId });\n    }\n\n    componentDidMount(): void {\n        const { getZigbeeDevicesList } = this.props;\n        const manager = new WebsocketManager();\n        console.log(\"use `copy(wsEventsData)` to copy events log\");\n        manager.subscribe(\"zigbee\", this.processZigbeeEvent);\n        getZigbeeDevicesList(true);\n        setTimeout(() => this.enableJoin(), 500);\n    }\n\n    renderDevices(): ComponentChild {\n        const { startInterview } = this.props;\n        const { events } = this.state;\n        const sortedEvents = orderBy(Object.entries(events), ([_, events]) => events[0].timestamp).reverse();\n\n        return (<Fragment>\n            {this.renderJoinButton()}\n            <div className=\"row no-gutters\">{sortedEvents.map(([ieeeAddr, events]) => <DeviceCard startInterview={startInterview}\n                ieeeAddr={ieeeAddr} events={events} />)}</div>\n        </Fragment>);\n\n    }\n\n    enableJoin = (targetRouter = '0x0000'): void => {\n        const { setJoinDuration } = this.props;\n\n        setJoinDuration(255, targetRouter).then(() => {\n            this.setState({ targetRouter });\n            new Notyf({ position: { x: \"left\", y: \"bottom\" } }).success(`Join enabled on ${targetRouter}`);\n        })\n\n    };\n    disableJoin = async () => {\n        const { targetRouter } = this.state;\n        const { setJoinDuration } = this.props;\n        await setJoinDuration(0, targetRouter);\n        new Notyf({ position: { x: \"left\", y: \"bottom\" } }).success(\"Join disabled\");\n    };\n\n    renderJoinButton(): ComponentChild {\n        const { joinDuration } = this.state;\n        const { devices } = this.props;\n        const routers = devices.filter(d => d.type == \"Router\");\n        return (<div class=\"row h-100 justify-content-center align-items-center\">\n            {joinDuration <= 0 ? (\n                <div class=\"btn-group\">\n                    <Button<string> className=\"btn btn-success\" onClick={this.enableJoin} item={'0x0000'}>Enable\n                     join</Button>\n                    <button type=\"button\" class=\"btn btn-success dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n                        <span class=\"sr-only\">Toggle</span>\n                    </button>\n                    <div class=\"dropdown-menu\">\n                        <a onClick={(): void => this.enableJoin(\"\")} class=\"dropdown-item\" href=\"#\">All devices</a>\n                        {\n                            routers.map(router => <a onClick={(): void => this.enableJoin(router.nwkAddr)} class=\"dropdown-item\" href=\"#\">{getDeviceDisplayName(router)}</a>)\n                        }\n                    </div>\n                </div>\n            ) : (<div>Join enabled for {joinDuration} seconds, <a href=\"#\" onClick={this.disableJoin}>Stop</a></div>)\n            }\n\n        </div>\n        );\n    }\n\n    renderEmptyScreen(): ComponentChild {\n        return (\n            <Fragment>\n                <div class=\"row h-100 justify-content-center align-items-center\">\n                    <h2>Nothing yet happened</h2>\n                </div>\n                {this.renderJoinButton()}\n            </Fragment>\n        );\n    }\n\n\n    render(): ComponentChild {\n        const { events } = this.state;\n        const hasAnyEvents = Object.keys(events).length !== 0;\n        return <div class=\"container-fluid h-100\">{hasAnyEvents ? this.renderDevices() : this.renderEmptyScreen()}</div>\n    }\n}\n\nconst mappedProps = [\"isLoading\", \"time\", \"devices\"];\nconst ConnectedDiscovery = connect<{}, DiscoveryState, GlobalState, Actions>(mappedProps, actions)(Discovery);\nexport default ConnectedDiscovery;\n","import { Component, ComponentChild, createRef, h } from \"preact\";\nimport style from \"./style.css\";\nimport cx from \"classnames\";\nimport { Notyf } from \"notyf\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\nimport { connect } from \"unistore/preact\";\nimport { useEffect } from \"preact/hooks\";\n\nexport enum LogLevel {\n    LOG_OFF,\n    LOG_NORMAL,\n    LOG_VERBOSE,\n    LOG_DEBUG\n}\n\nexport interface LogViewerState {\n    followLog: boolean;\n}\n\nexport class LogViewer extends Component<GlobalState & Actions, LogViewerState> {\n    ref = createRef<HTMLDivElement>();\n\n    constructor() {\n        super();\n        this.state = {\n            followLog: true\n        };\n    }\n\n    componentDidMount(): void {\n        const { fetchLogsBuffer, getCurrentLogLevel } = this.props;\n        fetchLogsBuffer().then(() => setTimeout(this.scrollToBottom, 500));\n        getCurrentLogLevel().then();\n    }\n\n\n    onFollowLogChange = (e: Event) => {\n        e.preventDefault();\n        const { followLog } = this.state;\n        this.setState({ followLog: !followLog });\n    };\n\n    onClearScreenClick = (e: Event) => {\n        const { clearLogs } = this.props;\n        clearLogs();\n    };\n    onClearCacheClick = (e: Event) => {\n        const { clearLogsBuffer } = this.props;\n        clearLogsBuffer().then(() => new Notyf().success(\"Cache cleared\"));\n    };\n\n    onLogLevelChange = (e: Event) => {\n        const { setLogLevel, getCurrentLogLevel } = this.props;\n        const { value } = e.target as HTMLInputElement;\n        const logLevel = parseInt(value);\n        setLogLevel(logLevel).then(() => getCurrentLogLevel());\n    };\n\n\n    scrollToBottom = (): void => {\n        this.ref.current.scrollTop = this.ref.current.scrollHeight;\n    };\n\n    render(): ComponentChild {\n        const { followLog } = this.state;\n        const { logLevel, logs } = this.props;\n\n        useEffect(() => {\n            followLog && this.scrollToBottom();\n        }, [followLog, logs.length]);\n\n        return (<div class=\"container-fluid h-100\">\n            <div class=\"row justify-content-around\">\n                <div class=\"col-sm-6 my-1\">\n                    <div class=\"btn-group\" role=\"group\" aria-label=\"Basic example\">\n                        <button onClick={this.onClearScreenClick} type=\"button\" class=\"btn btn-secondary\">Clear screen\n                        </button>\n                        <button onClick={this.onClearCacheClick} type=\"button\" class=\"btn btn-danger\">Clear logs cache\n                        </button>\n                    </div>\n                </div>\n                <div class=\"col-sm-6 my-1\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-sm-4\">\n                            <select value={logLevel} class=\"custom-select\" onChange={this.onLogLevelChange}>\n                                <option value={LogLevel.LOG_OFF} selected>LOG_OFF</option>\n                                <option value={LogLevel.LOG_NORMAL} selected>LOG_NORMAL</option>\n                                <option value={LogLevel.LOG_VERBOSE}>LOG_VERBOSE</option>\n                                <option value={LogLevel.LOG_DEBUG}>LOG_DEBUG</option>\n                            </select>\n                        </div>\n                        <div class=\"col-sm2\">\n                            <div class=\"form-check form-check-inline\">\n                                <input checked={followLog} onChange={this.onFollowLogChange} class=\"form-check-input\"\n                                       type=\"checkbox\" id=\"followLog\" value=\"true\" />\n                                <label class=\"form-check-label\" for=\"followLog\">Follow log</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n\n            <div ref={this.ref} class={cx(\"h-100\", style[\"log-main\"])}>\n                {logs.map((line, lineNum) =>\n                    <div class={style[\"log-line\"]}>\n                        <a class={style[\"log-line-num\"]}>{lineNum + 1}</a>\n                        <span>{line}</span>\n                    </div>)}\n            </div>\n        </div>);\n    }\n}\n\nconst mappedProps = [\"logs\", \"logLevel\"];\nconst ConnectedLogViewer = connect<{}, LogViewerState, GlobalState, Actions>(mappedProps, actions)(LogViewer);\nexport default ConnectedLogViewer;","import { Component, ComponentChild, h } from \"preact\";\nimport styles from \"./style.css\";\n\nexport interface Named {\n    name: string;\n}\n\ninterface TreeViewProps<T extends Named> {\n    items: T[];\n\n    onItemClick(item: T): void;\n\n    onDeleteClick(item: T): void;\n}\n\ninterface FileLinkProps<T extends Named> {\n    items: T;\n\n    onClick(item: T): void;\n\n    onDeleteClick(item: T): void;\n}\n\nclass TreeItem<T extends Named> extends Component<FileLinkProps<T>, {}> {\n    onClick = (): void => {\n        const { onClick, items } = this.props;\n        onClick(items);\n    };\n    onDeleteClick = (): void => {\n        const { onDeleteClick, items } = this.props;\n        onDeleteClick(items);\n    };\n\n    render(): ComponentChild {\n        const { items } = this.props;\n        return <div class={`list-group-item list-group-item-action bg-light ${styles[\"file-link\"]}`}>\n            <a onClick={this.onClick} href={\"#\"}>{items.name}</a>\n            <i onClick={this.onDeleteClick} class=\"fa fa-trash\" />\n        </div>;\n    }\n}\n\nexport default class TreeView<T extends Named> extends Component<TreeViewProps<T>, {}> {\n    render(): ComponentChild {\n        const { items, onDeleteClick, onItemClick } = this.props;\n\n        return <div>\n            {items.map(file => (<TreeItem onDeleteClick={onDeleteClick} items={file} onClick={onItemClick} />))}\n        </div>;\n    }\n}","import { Component, createRef, h } from \"preact\";\nimport CM, { EditorFromTextArea } from \"codemirror\";\nimport { parse } from \"luaparse\";\ninterface CodeMirrorProps {\n    code: string;\n    height?: string;\n    width?: string;\n    config: CM.EditorConfiguration;\n\n    onChange?(value: string): void;\n}\n\nCM && CM.registerHelper('lint', 'lua', (text) => {\n    const found = [];\n    try {\n        const parseResult = parse(text);\n        console.log(parseResult);\n    } catch (e) {\n        found.push({\n            from: CM.Pos(e.line - 1, e.column),\n            to: CM.Pos(e.line- 1, e.index),\n            message: e.message});\n        console.error(e);\n    }\n    return found;\n});\n\n\nexport default class CodeMirror extends Component<CodeMirrorProps, {}> {\n    ref = createRef<HTMLTextAreaElement>();\n    codeMirror: EditorFromTextArea;\n\n    constructor() {\n        super();\n    }\n\n    codemirrorValueChanged = (doc, change) => {\n        const { onChange } = this.props;\n        if (onChange && change.origin !== \"setValue\") {\n            onChange(doc.getValue());\n        }\n    };\n\n    componentDidMount(): void {\n        const { current } = this.ref;\n        const { config, code, height, width } = this.props;\n        this.codeMirror = CM.fromTextArea(current, config);\n        this.codeMirror.on(\"change\", this.codemirrorValueChanged);\n        this.codeMirror.setValue(code);\n        this.codeMirror.setSize(width, height);\n\n    }\n\n    // eslint-disable-next-line react/no-deprecated\n    componentWillReceiveProps(nextProps: Readonly<CodeMirrorProps>, nextContext: any): void {\n        const { height, width, code, config } = nextProps;\n        const { code: currentCode } = this.props;\n        Object.entries(config).forEach(([name, value]) => {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n            // @ts-ignore\n            this.codeMirror.setOption(name, value);\n        });\n\n        this.codeMirror.setSize(width, height);\n        if (currentCode != code) {\n            const prevScrollPosition = this.codeMirror.getScrollInfo();\n            const prevCursor = this.codeMirror.getCursor();\n            this.codeMirror.setValue(code);\n            this.codeMirror.scrollTo(prevScrollPosition.left, prevScrollPosition.top);\n            this.codeMirror.setCursor(prevCursor);\n        }\n    }\n\n    render() {\n        return (\n            <textarea ref={this.ref} />\n        );\n    }\n}","import { Component, ComponentChild, Fragment, h } from \"preact\";\n\nimport style from \"./style.css\";\nimport cx from \"classnames\";\nimport TreeView from \"../tree-view\";\nimport CodeMirror from \"./codemirror\";\nimport { Dictionary, FileDescriptor } from \"../../types\";\nimport { Notyf } from \"notyf\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\n\ninterface CodeEditorState {\n    sideBarIsVisible: boolean;\n}\n\nexport class CodeEditor extends Component<GlobalState & Actions, CodeEditorState> {\n    constructor() {\n        super();\n        this.state = {\n            sideBarIsVisible: true\n        };\n    }\n\n    onCodeChange = (code) => {\n        const { setCurrentFileContent } = this.props;\n        setCurrentFileContent(code);\n    };\n\n    onExecuteCode = () => {\n        const { currentFileContent, evalCode } = this.props;\n        evalCode(currentFileContent).then();\n    };\n    onSaveCode = () => {\n        const { currentFile, currentFileContent, writeFile } = this.props;\n        writeFile(currentFile.name, currentFileContent)\n            .then(() => new Notyf().success(`Saved ${currentFile.name}`));\n\n    };\n\n\n    onCreateFile = () => {\n        const { writeFile } = this.props;\n        let fileName = prompt(\"Enter file name\");\n        if (fileName) {\n            if (!fileName.startsWith(\"/\")) {\n                fileName = `/${fileName}`;\n            }\n            writeFile(fileName, \"\").then(() => this.loadFiles(\"/\"));\n        }\n    };\n\n    onDeleteClick = (file: FileDescriptor): void => {\n        const { deleteFile } = this.props;\n        if (confirm(`Delete ${file.name}?`)) {\n            deleteFile(file).then(() => this.loadFiles(\"/\"));\n        }\n    };\n    loadFile = (file: FileDescriptor): void => {\n        const { readFile } = this.props;\n        readFile(file);\n    };\n\n\n    renderCodeExecutionResults(): ComponentChild {\n        const { executionResults } = this.props;\n\n        if (executionResults) {\n            return <div class={cx(\"h-24\", {\n                \"text-success\": executionResults.success,\n                \"text-danger\": !executionResults.success\n            })}>\n                Output:\n                <pre><code>{executionResults.result ?? \"NO RESPONSE\"}</code></pre>\n            </div>;\n        }\n        return null;\n\n    }\n\n    componentDidMount(): void {\n        this.loadFiles(\"/\");\n    }\n\n    loadFiles(path: string): void {\n        const { getFilesList } = this.props;\n        getFilesList(path);\n    }\n\n    toggleSideBar = (): void => {\n        const { sideBarIsVisible } = this.state;\n        this.setState({ sideBarIsVisible: !sideBarIsVisible });\n    };\n\n    getFileType(): string {\n        const fileExtPattern = /\\.([0-9a-z]+)$/i;\n        const { currentFile } = this.props;\n        if (currentFile) {\n            const { name } = currentFile;\n            if (fileExtPattern.test(name)) {\n                const [extWithDot, ext] = fileExtPattern.exec(name);\n                return ext;\n            }\n        }\n        return \"\";\n    }\n\n    onFormatClick = (): void => {\n        const { currentFileContent, setCurrentFileContent } = this.props;\n        if (this.getFileType() === \"json\") {\n            try {\n                const res = JSON.parse(currentFileContent);\n                setCurrentFileContent(JSON.stringify(res, null, 2));\n            } catch (e) {\n                new Notyf().error(e.toString());\n            }\n        } else {\n            new Notyf().error(\"Not implemented 😢\");\n        }\n    };\n\n    getMode(): string | Dictionary<string | boolean> {\n\n        switch (this.getFileType()) {\n            case \"json\":\n                return {\n                    name: \"javascript\",\n                    json: true\n                };\n            case \"script\":\n            case \"lua\":\n                return \"lua\";\n            default:\n                return \"\";\n        }\n\n    }\n\n    render(): ComponentChild {\n        const { sideBarIsVisible } = this.state;\n        const { currentFileContent, executionResults, files, currentFile, clearExecutionResults } = this.props;\n\n        const config = {\n            mode: this.getMode(),\n            theme: \"dracula\",\n            styleActiveLine: true,\n            lineNumbers: true,\n            lint: true,\n            gutters: [\"CodeMirror-lint-markers\"],\n            extraKeys: {\n                \"Ctrl-E\": this.onExecuteCode,\n                \"Cmd-E\": this.onExecuteCode,\n                \"Ctrl-S\": this.onSaveCode,\n                \"Cmd-S\": this.onSaveCode\n            }\n        };\n        const hasExecutionResults = !!executionResults;\n        const hasCode = currentFileContent && currentFileContent.length;\n\n\n        return (<div className={cx(\"h-100 px-0 d-flex\", style[\"code-editor\"])}>\n            <div class={cx(\"d-flex w-100\", style.wrapper, {\n                [style.toggled]: !sideBarIsVisible\n            })}>\n\n                <div class={cx(\"bg-light border-right position-relative\", style[\"sidebar-wrapper\"])}>\n                    <div class={style[\"sidebar-heading\"]}>Files</div>\n                    <div class=\"list-group list-group-flush\">\n\n                        <TreeView onItemClick={this.loadFile} onDeleteClick={this.onDeleteClick} items={files} />\n                        <button onClick={this.onCreateFile} type=\"button\"\n                                class={cx(\"btn\", \"btn-primary\", style[\"new-file\"])}>New file\n                        </button>\n                    </div>\n\n                </div>\n\n                <div class={style[\"page-content-wrapper\"]}>\n\n                    <nav class=\"navbar navbar-expand-lg navbar-light bg-light border-bottom\">\n                        <button onClick={this.toggleSideBar} class=\"btn btn-primary\">Toggle files</button>\n                        {currentFile ? <button type=\"button\" class=\"btn btn-success\"\n                                               onClick={this.onSaveCode}>Save(Ctrl-S)</button> : null}\n                        {hasCode ? (\n                            <Fragment>\n                                <button type=\"button\" class=\"btn btn-danger\" onClick={this.onExecuteCode}>Run(Ctrl-E)\n                                </button>\n                                {\n                                    this.getFileType() === \"json\" ? (\n                                        <button type=\"button\" class=\"btn btn-primary\"\n                                                onClick={this.onFormatClick}>Format\n                                        </button>\n                                    ) : null\n                                }\n\n                            </Fragment>\n                        ) : null}\n                        {hasExecutionResults ?\n                            <button type=\"button\" class=\"btn btn-primary\" onClick={clearExecutionResults}>Clear\n                                output</button> : null}\n\n                        <div>\n                            {currentFile ? <input type=\"text\" placeholder={currentFile.name} readOnly /> : null}\n                        </div>\n                    </nav>\n\n\n                    <div class=\"h-100\">\n                        <div class={\"h-75\"}>\n                            <CodeMirror height={\"100%\"} width={\"100%\"} code={currentFileContent} config={config}\n                                        onChange={this.onCodeChange} />\n                        </div>\n\n                        {this.renderCodeExecutionResults()}\n                    </div>\n                </div>\n            </div>\n        </div>);\n    }\n\n}\n\nconst mappedProps = [\"isLoading\", \"files\", \"executionResults\", \"currentFileContent\", \"currentFile\"];\nconst ConnectedCodeEditor = connect<{}, CodeEditorState, GlobalState, Actions>(mappedProps, actions)(CodeEditor);\nexport default ConnectedCodeEditor;","import { FunctionalComponent, h, RefObject } from \"preact\";\nimport { forwardRef } from \"preact/compat\";\n\n\ninterface UniversalEditorProps {\n    value: unknown;\n    onChange(value: unknown): void;\n    [k: string]: unknown;\n}\n\n\nconst UniversalEditor: FunctionalComponent<UniversalEditorProps> = forwardRef((props, ref: RefObject<HTMLInputElement>) => {\n    const { value, onChange, ...rest } = props;\n    const changeHandler = (event) => {\n        const { target } = event;\n        switch (target.type) {\n            case \"checkbox\":\n                onChange(target.checked);\n                break;\n            case \"number\":\n                target.valueAsNumber != value && onChange(target.valueAsNumber);\n                break;\n            default:\n                target.value != value && onChange(target.value);\n                break;\n        }\n    };\n    switch (typeof value) {\n        case \"boolean\":\n            return <input ref={ref} {...rest} type=\"checkbox\" checked={value} onChange={changeHandler}\n                          class=\"form-check-input\" />;\n        case \"number\":\n            return <input step=\"any\" ref={ref} {...rest} type=\"number\" value={value} onBlur={changeHandler} />;\n        default:\n            return <input ref={ref} {...rest} type=\"text\" value={value as string} onBlur={changeHandler} />;\n    }\n});\nexport default UniversalEditor;","import { Component, ComponentChild, h } from \"preact\";\nimport { Device, Dictionary } from \"../../types\";\nimport style from \"./style.css\";\nimport UniversalEditor from \"../universal-editor\";\nimport actions, { Actions } from \"../../actions\";\nimport { Notyf } from \"notyf\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\n\ninterface PropsFromStore {\n    device: Device | undefined;\n}\n\ntype DeviceParamTuple = [string, unknown];\n\n\nexport class SimpleBind extends Component<PropsFromStore & Actions, {}> {\n    setStateValue = async (name: string, value: unknown) => {\n        const { setStateValue, device, getDeviceInfo } = this.props;\n        await setStateValue(device.nwkAddr, name, value);\n        new Notyf().success(`Successfully updated state value ${name}=${value}`);\n        getDeviceInfo(device.nwkAddr);\n\n    };\n    setSimpleBind = async (name: string, value: unknown) => {\n        const { device, setSimpleBindValue, getDeviceInfo } = this.props;\n        await setSimpleBindValue(device.nwkAddr, name, value);\n        new Notyf().success(`Successfully updated simple bind value ${name}=${value}`);\n        getDeviceInfo(device.nwkAddr);\n    };\n\n    render(): ComponentChild {\n        const { device } = this.props;\n        if (device) {\n            return this.renderSimpleBinds();\n        } else {\n            return \"Loading...\";\n        }\n\n    }\n\n    renderSimpleBinds(): ComponentChild {\n        const { device } = this.props;\n        const simpleBindRules: Dictionary<string> = device.SB ?? {};\n\n        const kv = Object.entries(device.st ?? {});\n\n\n        return <table class=\"table table-striped table-borderless\">\n            <thead>\n            <tr>\n                <th scope=\"col\" />\n                <th scope=\"col\">Value</th>\n                <th scope=\"col\">SB rule</th>\n            </tr>\n            </thead>\n            <tbody>\n            {kv.map((param: DeviceParamTuple) => (\n                <tr class={style[\"props-row\"]}>\n                    <th scope=\"row\">{param[0]}</th>\n                    <td class={style[\"value-col\"]}>\n                        <UniversalEditor\n                            className=\"form-control-plaintext\"\n                            value={param[1]}\n                            onChange={(value) => this.setStateValue(param[0], value)}\n                        />\n                    </td>\n                    <td>\n                        <UniversalEditor\n                            className=\"form-control form-control-plaintext\"\n                            value={simpleBindRules[param[0]] || \"\"}\n                            onChange={(value) => this.setSimpleBind(param[0], value)}\n                        />\n                    </td>\n                </tr>\n            ))}\n            </tbody>\n        </table>;\n\n    }\n}\n\nconst mappedProps = [\"device\"];\n\nexport default connect<{}, {}, GlobalState, PropsFromStore>(mappedProps, actions)(SimpleBind);","import { Component, ComponentChild, Fragment, h } from \"preact\";\nimport { Device } from \"../../types\";\nimport SafeImg from \"../safe-image\";\nimport { genDeviceDetailsLink, genDeviceImageUrl, toHex } from \"../../utils\";\nimport DeviceControlGroup from \"../device-control\";\nimport PowerSourceComp from \"../power-source\";\nimport style from \"./style.css\";\nimport { getClusterName } from \"./bind\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\n\ninterface PropsFromStore {\n    device: Device ;\n}\n\nexport class DeviceInfo extends Component<PropsFromStore, {}> {\n    render(): ComponentChild {\n        const { device } = this.props;\n        if (device) {\n            return this.renderDeviceInfo();\n        } else {\n            return \"Loading...\";\n        }\n    }\n\n    renderDeviceInfo(): ComponentChild {\n        const { device } = this.props;\n        const endpoints = Object.entries(device.ep ?? {}).map(([epName, ep]) => {\n            const inClusters = Object.entries(ep.In ?? {}).map(([clusterId]) => {\n                const cluster = parseInt(clusterId, 10);\n                return <small class={\"d-block text-nowrap text-truncate\"}\n                              title={toHex(cluster, 4)}>{getClusterName(cluster, false)}</small>;\n            });\n            const outClusters = Object.entries(ep.Out ?? {}).map(([clusterId]) => {\n                const cluster = parseInt(clusterId, 10);\n                return <small class={\"d-block text-nowrap text-truncate\"}\n                              title={toHex(cluster, 4)}>{getClusterName(cluster, false)}</small>;\n            });\n            return (<Fragment>\n                <dt class=\"col-5\">Endpoint #{epName}</dt>\n                <dl class={\"col-6\"} />\n\n                <dd class=\"col-5\">ProfileId</dd>\n                <dl class={\"col-7\"}>{ep.profId}</dl>\n\n                <dd class=\"col-5\">DeviceId</dd>\n                <dl class={\"col-7\"}>{ep.devId}</dl>\n\n                <dd class={\"col-5 text-nowrap\"}>Input clusters</dd>\n                <dl class=\"col-7\">{inClusters.length ? inClusters : <b>None</b>}</dl>\n                <dd class={\"col-5 text-nowrap\"}>Output clusters</dd>\n                <dl class=\"col-7\">{outClusters.length ? outClusters : <b>None</b>}</dl>\n\n            </Fragment>);\n        });\n        return (\n            <div class=\"card mb-3\">\n                <SafeImg class={`card-img-top ${style[\"device-pic\"]}`} src={genDeviceImageUrl(device)} />\n                <div class=\"card-body\">\n                    <h5 class=\"card-title\">{device.type}</h5>\n\n                    <dl class=\"row\">\n                        {\n                            device.friendly_name ? (\n                                <Fragment>\n                                    <dt class=\"col-5\">Friendly name</dt>\n                                    <dd class=\"col-7\">{device.friendly_name}</dd>\n                                </Fragment>\n                            ) : null\n                        }\n\n\n                        <dt class=\"col-5\">ieeeAddr</dt>\n                        <dd class=\"col-7\">{device.ieeeAddr}</dd>\n\n                        <dt class=\"col-5\">nwkAddr</dt>\n                        <dd class=\"col-7\">{device.nwkAddr}</dd>\n\n                        <dt class=\"col-5\">Power source</dt>\n                        <dd class=\"col-7\"><PowerSourceComp source={device.PowerSource}\n                                                           battery={device?.st?.battery} /></dd>\n\n                        <dt class=\"col-5\">ManufName</dt>\n                        <dd class=\"col-7\">{device.ManufName}</dd>\n\n                        <dt class=\"col-5\">ModelId</dt>\n                        <dd class=\"col-7\">{device.ModelId}</dd>\n\n\n\n                        <dt class=\"col-5\">Routes</dt>\n                        <dd class=\"col-7\">{device?.Rtg?.map((route) => <a className={\"d-block\"}\n                                                                          href={genDeviceDetailsLink(route)}>{route}</a>)}</dd>\n                        {endpoints}\n                    </dl>\n\n                </div>\n                <div class=\"card-footer\">\n                    <DeviceControlGroup device={device} />\n                </div>\n            </div>\n        );\n    }\n}\n\nconst mappedProps = [\"device\"];\n\nexport default connect<{}, {}, GlobalState, PropsFromStore>(mappedProps)(DeviceInfo);","import { Component, ComponentChild, h } from \"preact\";\nimport Bind from \"../device-page/bind\";\nimport cx from \"classnames\";\n\nexport interface TabInfo {\n    name: string;\n    TabComponent: ComponentChild;\n}\n\ninterface TabPanelProps {\n    tabs: TabInfo[];\n    defaultTab?: string;\n}\n\ninterface TabPanelState {\n    activeTab: string;\n}\n\ninterface TabLinkProps {\n    name: string;\n    isActive: boolean;\n\n    onClick(arg1: string): void;\n}\n\nexport class TabLink extends Component<TabLinkProps, {}> {\n    onClick = (): void => {\n        const { name, onClick } = this.props;\n        onClick(name);\n    };\n\n    render(): ComponentChild {\n        const { name, isActive } = this.props;\n        return <a onClick={this.onClick} class={cx(\"nav-link\", { active: isActive })} id={`${name}-tab`}\n                  data-toggle=\"tab\" href={`#${name}`} role=\"tab\" aria-controls={name} aria-selected=\"true\">{name}</a>;\n    }\n}\n\nexport default class TabPanel extends Component<TabPanelProps, TabPanelState> {\n    constructor() {\n        super();\n        this.state = {\n            activeTab: \"Bind\"\n        };\n    }\n\n    componentDidMount(): void {\n        this.initializeDefaultTab();\n    }\n\n    initializeDefaultTab(): void {\n        const { defaultTab } = this.props;\n        if (defaultTab) {\n            this.setState({ activeTab: defaultTab });\n        }\n    }\n\n    onTabLinkClick = (activeTab: string): void => {\n        this.setState({ activeTab });\n    };\n\n\n    render(): ComponentChild {\n        const { activeTab } = this.state;\n        const { tabs } = this.props;\n\n        return (<div>\n                <ul class=\"nav nav-tabs\">\n                    {\n                        tabs.map(({ name }) => (\n                            <li key={name} class=\"nav-item\">\n                                <TabLink name={name} isActive={name === activeTab} onClick={this.onTabLinkClick} />\n                            </li>\n                        ))\n                    }\n                </ul>\n                <div class=\"tab-content\">\n                    {\n                        tabs.map(({ name, TabComponent }) => (\n                            <div key={name} class={cx(\"tab-pane fade\", {\n                                \"show active\": activeTab === name\n                            })}>{TabComponent}</div>\n                        ))\n                    }\n                </div>\n            </div>\n        );\n    }\n}","import { Component, ComponentChild, h } from \"preact\";\nimport { connect } from \"unistore/preact\";\nimport actions, { Actions } from \"../../actions\";\nimport { GlobalState } from \"../../store\";\nimport SimpleBind from \"./simple-bind\";\nimport Bind from \"./bind\";\nimport DeviceInfo from \"./info\";\nimport TabPanel, { TabInfo } from \"../tab-panel\";\nimport style from \"./style.css\";\n\ninterface DevicePageState {\n    dev: string;\n    activeTab: string;\n}\n\nexport class DevicePage extends Component<Actions & GlobalState, DevicePageState> {\n    constructor() {\n        super();\n        const { searchParams } = new URL(location.href);\n        const paramActiveTab = searchParams.get(\"activeTab\");\n        const deviceId = searchParams.get(\"dev\");\n        this.state = {\n            dev: deviceId,\n            activeTab: paramActiveTab ? paramActiveTab : \"Info\"\n        };\n    }\n\n    componentDidMount(): void {\n        this.initPage();\n    }\n\n    initPage(): void {\n        const { dev } = this.state;\n        const { getDeviceInfo, getZigbeeDevicesList, getDeviceBinds } = this.props;\n\n        getDeviceInfo(dev);\n        getDeviceBinds(dev);\n        getZigbeeDevicesList(true);\n\n    }\n\n    render(): ComponentChild {\n        const { isLoading, isError } = this.props;\n        const { activeTab } = this.state;\n\n        const tabs: TabInfo[] = [\n            {\n                name: \"Info\",\n                TabComponent: <DeviceInfo />\n            },\n            {\n                name: \"Bind\",\n                TabComponent: <Bind />\n            },\n            {\n                name: \"States\",\n                TabComponent: <SimpleBind />\n            }\n        ];\n        return (<div class={\"position-relative\"}>\n            {\n                isError ? <h1>{isError}</h1> : (\n                    isLoading ? (\n                        <div className={`${style.loader} spinner-grow text-primary`} role=\"status\">\n                            <span className=\"sr-only\">Loading...</span>\n                        </div>\n                    ) : null\n                )\n\n            }\n            <TabPanel defaultTab={activeTab} tabs={tabs} />\n        </div>);\n\n    }\n}\n\nconst mappedProps = [\"isLoading\", \"isError\"];\nconst ConnectedDevicePage = connect<{}, DevicePageState, GlobalState, Actions>(mappedProps, actions)(DevicePage);\nexport default ConnectedDevicePage;","import createStore from \"unistore\";\nimport devtools from \"unistore/devtools\";\n\nimport { BindRule, Device, FileDescriptor } from \"./types\";\nimport { TimeInfo } from \"./components/discovery/types\";\nimport { LogLevel } from \"./components/log-viewer\";\nimport { ApiResponse } from \"./utils\";\n\n\nexport interface GlobalState {\n    isLoading: boolean;\n    isError: boolean | string;\n    device: Device | undefined;\n    devices: Device[];\n    bindRules: BindRule[];\n    time: TimeInfo | undefined;\n    logs: string[];\n    logLevel: LogLevel;\n\n\n    files: FileDescriptor[];\n    executionResults: ApiResponse<string> | null;\n\n    currentFileContent: string;\n    currentFile: FileDescriptor;\n\n\n\n}\n\nconst initialState: GlobalState = {\n    device: undefined,\n    isLoading: false,\n    isError: false,\n    devices: [],\n    bindRules: [{} as BindRule],\n    time: undefined,\n    logs: [],\n    logLevel: LogLevel.LOG_DEBUG,\n\n\n    files: [],\n    executionResults: null,\n    currentFileContent: \"\",\n    currentFile: null\n};\n\nconst store = process.env.NODE_ENV === 'production' ?  createStore(initialState) : devtools(createStore(initialState));\n\nexport default store;","// Must be the first import\n\n\n\n\nif (process.env.NODE_ENV==='development') {\n    // Must use require here as import statements are only allowed\n    // to exist at the top of a file.\n    require(\"preact/debug\");\n\n}\n\n// const poly = require(\"preact-cli/lib/lib/webpack/polyfills\");\nimport \"notyf/notyf.min.css\";\n\nimport habitat from \"preact-habitat\";\nimport ConnectedMap from \"./components/map\";\nimport ConnectedZigbeeTable from \"./components/zigbee\";\nimport ConnectedDiscovery from \"./components/discovery\";\nimport ConnectedLogViewer from \"./components/log-viewer\";\nimport ConnectedCodeEditor from \"./components/code-editor\";\nimport ConnectedDevicePage from \"./components/device-page\";\nimport store from \"./store\";\nimport { Provider } from \"unistore/preact\";\nimport { h } from \"preact\";\n\nconst DevicePageApp = () => (\n    <Provider store={store}><ConnectedDevicePage /></Provider>\n);\nconst ZigbeeTableApp = () => (\n    <Provider store={store}><ConnectedZigbeeTable /></Provider>\n);\n\nconst MapApp = () => (\n    <Provider store={store}><ConnectedMap /></Provider>\n);\nconst DiscoveryApp = () => (\n    <Provider store={store}><ConnectedDiscovery /></Provider>\n);\nconst LogViewerApp = () => (\n    <Provider store={store}><ConnectedLogViewer /></Provider>\n);\nconst CodeEditorApp = () => (\n    <Provider store={store}><ConnectedCodeEditor /></Provider>\n);\n\nconst initWidgets = (): void => {\n    habitat(ZigbeeTableApp).render({\n        selector: \"[data-widget-host=\\\"zigbee\\\"]\",\n        clean: true\n    });\n\n    habitat(DevicePageApp).render({\n        selector: \"[data-widget-host=\\\"device-page\\\"]\",\n        clean: true\n    });\n\n    habitat(MapApp).render({\n        selector: \"[data-widget-host=\\\"map\\\"]\",\n        clean: true\n    });\n\n    habitat(DiscoveryApp).render({\n        selector: \"[data-widget-host=\\\"discovery\\\"]\",\n        clean: true\n    });\n    habitat(LogViewerApp).render({\n        selector: \"[data-widget-host=\\\"log-viewer\\\"]\",\n        clean: true\n    });\n\n    habitat(CodeEditorApp).render({\n        selector: \"[data-widget-host=\\\"code-editor\\\"]\",\n        clean: true\n    });\n\n\n};\ndocument.addEventListener(\"DOMContentLoaded\", initWidgets);","// extracted by mini-css-extract-plugin\nmodule.exports = {\"tooltip\":\"_1rk7BV3JOGLq0LBsDwlTT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"plug\":\"_1rcBQvphkleKOfovl_Pvke\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dashed-link\":\"_1fFt3mhoAjHdI9KjdXwiJG\",\"value-col\":\"_39TL8GArlQw7aUWe8UA51_\",\"props-row\":\"_2fm-PHIZ1vjSCIb2ZiDh9g\",\"device-pic\":\"_3TwJuuVA3A34CV1N2Vm57a\",\"loader\":\"_3X7MQ7DTf8-WnWd6NzQ0Ah\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"zigbee\":\"pyUw6XrDJwVDAd3O8540m\",\"actions\":\"gw3rbQq5ewCSIxGBpPmLW\",\"action-column\":\"_9SKic9U7zOc4ced8VnqrQ\",\"invisible\":\"xL9O5xYzyPwhLPC4mMolg\",\"adaptive\":\"_3muOVdl36jJiVia7saOlXF\",\"device-image\":\"_1iHkacKbhmIu3DVhNRYbcT\",\"nwk-addr\":\"EFe8Zugx_CKGG7nI77css\",\"ieee-addr\":\"_1GxvFsSniUTQeAfkPTn-cK\",\"manu-name\":\"_3hdFev3NLQTc3kbVCsXlHM\",\"device-pic\":\"_1mC0z2WyiQ2lZUxLOQpEt5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"device-image\":\"_1hcagYbY_Y6eeTNwa8vpcB\",\"scale-in-center\":\"_215Q2JzCNabshB1BCJTrhS\",\"blink\":\"_16C5lzFK8yu8gOeBQzvevo\"};","module.exports = window.luaparse;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"code-editor\":\"geoNa2kIUpUOXRRhXv41P\",\"new-file\":\"_3bamqu8MV-LdBWIqwXZF-m\",\"sidebar-wrapper\":\"_3W7vvcN5rn-Hks20WXtAxn\",\"sidebar-heading\":\"_3jzXMdkdqB1jZWSn8jJrxy\",\"page-content-wrapper\":\"_2b1ylNBPUCV70QwL8PCeVi\",\"wrapper\":\"_2iW__Y0Jv3LpP7xYpJL3Rn\",\"toggled\":\"_1QAgcfZ8fkCv8iLqfl7-tD\"};","module.exports = window.CodeMirror;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"file-link\":\"_1AT4Zc2jmRShgInKdjrlnt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"log-main\":\"_PTLkMdFkXUDWwzPaERqN\",\"log-line-num\":\"_3NyLFE6WWES_iOq0-i6PJP\",\"log-line\":\"t9x92HLE4CKZHxsr5l9VR\"};"],"sourceRoot":""}